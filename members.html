<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Member Directory | JBRRMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f4f4f4;margin:0}
header{background:#7b0000;color:#fff;padding:15px;text-align:center}
.container{
  max-width:1100px;margin:20px auto;
  background:#fff;padding:15px;border-radius:10px
}
input{
  width:100%;padding:10px;margin:10px 0;
  font-size:14px
}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border:1px solid #ccc;padding:6px;text-align:left}
th{background:#eee}
.badge{
  background:#28a745;color:#fff;
  padding:3px 6px;border-radius:4px;
  font-size:12px
}
.footer{
  text-align:center;font-size:12px;
  color:#555;margin:30px 0
}
.no{color:#dc3545;font-weight:bold;text-align:center}
</style>
</head>

<body>

<header>
  <h2>üìã Public Member Directory</h2>
  <p>‡§ú‡§Ø ‡§≠‡§µ‡§æ‡§®‡•Ä ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§∞‡§æ‡§ú‡§™‡•Ç‡§§ ‡§Æ‡§π‡§æ‡§∏‡§≠‡§æ</p>
</header>

<div class="container">
  <input
    type="text"
    id="q"
    placeholder="‡§®‡§æ‡§Æ / ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ / Member ID ‡§∏‡•á ‡§ñ‡•ã‡§ú‡•á‡§Ç‚Ä¶"
    onkeyup="filterMembers()"
  >

  <table id="tbl">
    <thead>
      <tr>
        <th>Member ID</th>
        <th>Name</th>
        <th>Mobile</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="msg"></div>
</div>

<div class="footer">
¬© ‡§ú‡§Ø ‡§≠‡§µ‡§æ‡§®‡•Ä ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§∞‡§æ‡§ú‡§™‡•Ç‡§§ ‡§Æ‡§π‡§æ‡§∏‡§≠‡§æ<br>
Public Read-Only Directory
</div>

<script>
let members = [];
const tbody = document.querySelector("#tbl tbody");
const msg = document.getElementById("msg");

/* ===== LOAD members.json (NO CACHE) ===== */
fetch("members.json?v=" + Date.now())
  .then(res => {
    if(!res.ok) throw new Error("Load error");
    return res.json();
  })
  .then(data => {
    if(!Array.isArray(data)) throw new Error("Invalid JSON");

    // ‚úÖ clean invalid records
    members = data.filter(m =>
      m &&
      m.id && m.id.toString().trim() !== ""
    );

    render(members);
  })
  .catch(err => {
    msg.innerHTML = "<p class='no'>‚ùå Member data load ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§Ü</p>";
    console.error(err);
  });

/* ===== RENDER TABLE ===== */
function render(list){
  tbody.innerHTML = "";

  if(list.length === 0){
    msg.innerHTML = "<p class='no'>‚ùå ‡§ï‡•ã‡§à ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</p>";
    return;
  }

  msg.innerHTML = "";

  list.forEach(m => {
    tbody.innerHTML += `
      <tr>
        <td>${m.id}</td>
        <td>${m.name || "-"}</td>
        <td>${m.mobile || "-"}</td>
        <td><span class="badge">Verified</span></td>
      </tr>
    `;
  });
}

/* ===== SEARCH / FILTER ===== */
function filterMembers(){
  const v = document.getElementById("q").value
    .toLowerCase().trim();

  const filtered = members.filter(m =>
    (m.name || "").toLowerCase().includes(v) ||
    (m.mobile || "").toString().includes(v) ||
    (m.id || "").toLowerCase().includes(v)
  );

  render(filtered);
}
</script>

</body>
</html>
