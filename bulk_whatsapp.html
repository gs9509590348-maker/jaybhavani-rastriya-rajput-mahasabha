<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Bulk WhatsApp | Admin тАУ JBRRMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{font-family:Arial;background:#f4f4f4;margin:0}

header{
  background:#25D366;color:#fff;
  text-align:center;padding:16px
}
header h2{margin:0}
header p{margin:6px 0 0;font-size:13px}

nav{
  background:#1b8f4a;
  display:flex;flex-wrap:wrap;
  justify-content:center
}
nav a{
  color:#fff;text-decoration:none;
  padding:8px 12px;font-size:14px
}
nav a:hover{background:#25D366}

.box{
  max-width:1100px;margin:25px auto;
  background:#fff;padding:20px;border-radius:10px
}
h2{color:#25D366;text-align:center;margin-top:0}

textarea{
  width:100%;height:120px;
  font-size:13px;margin:10px 0
}

table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border:1px solid #ccc;padding:6px;text-align:left}
th{background:#eee}

.btn{
  padding:10px 16px;background:#25D366;
  color:#fff;border:none;border-radius:6px;
  cursor:pointer;margin-top:12px;font-size:14px
}
.gray{background:#555}

.note{font-size:12px;color:#555;margin:8px 0;line-height:1.6}
.count{font-size:13px;margin:6px 0}

footer{
  text-align:center;font-size:12px;
  color:#555;margin:30px 10px
}
footer a{color:#25D366;text-decoration:none}
</style>
</head>

<body>

<script>
/* ЁЯФР SESSION BASED ADMIN CHECK */
if(sessionStorage.getItem("admin")!=="1"){
  alert("тЭМ Unauthorized Access");
  location.href="admin_login.html";
}
</script>

<header>
  <h2>ЁЯУ▓ Bulk WhatsApp Sender</h2>
  <p>Admin Panel тАУ Verified / Pending Members</p>
</header>

<nav>
  <a href="admin_dashboard.html">ЁЯУК Dashboard</a>
  <a href="bulk_whatsapp.html">ЁЯУ▓ Bulk WhatsApp</a>
  <a href="../members.html" target="_blank">ЁЯзСтАНЁЯдЭтАНЁЯзС Members</a>
  <a href="../verify.html" target="_blank">ЁЯФН Verify</a>
  <a href="../index.html" target="_blank">ЁЯПа Website</a>
</nav>

<div class="box">

<h2>ЁЯУд Send WhatsApp Messages</h2>

<div class="note">
тЬФ WhatsApp рдПрдХ-рдПрдХ рдХрд░рдХреЗ рдирдП tabs рдореЗрдВ рдЦреБрд▓реЗрдЧрд╛<br>
тЬФ Message template editable рд╣реИ
</div>

<div class="count">
Total Members with Mobile: <b id="cnt">0</b>
</div>

<label><b>Message Template:</b></label>
<textarea id="msg">
ЁЯЩП рдЬрдп рднрд╡рд╛рдиреА | рдЬрдп рд░рд╛рдЬрдкреВрддрд╛рдирд╛ ЁЯЪй

рдЖрдкрдХрд╛ рд╕рджрд╕реНрдпрддрд╛ рд╡рд┐рд╡рд░рдг рдЙрдкрд▓рдмреНрдз рд╣реИ тЬЕ

рдирд╛рдо: {{name}}
Member ID: {{id}}

Verify ЁЯСЗ
{{verify}}
</textarea>

<table id="tbl">
<thead>
<tr>
<th>Send</th>
<th>Name</th>
<th>Mobile</th>
<th>Member ID</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div style="text-align:center">
  <button class="btn" onclick="send()">ЁЯУ▓ Send Selected</button>
  <button class="btn gray" onclick="location.reload()">ЁЯФД Reload</button>
</div>

</div>

<footer>
┬й 2026 рдЬрдп рднрд╡рд╛рдиреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рд░рд╛рдЬрдкреВрдд рдорд╣рд╛рд╕рднрд╛<br>
Bulk WhatsApp Tool тАУ Admin Use Only
</footer>

<script>
let members=[];

/* ===== LOAD members.json ===== */
fetch("../data/members.json?v="+Date.now())
.then(r=>{
  if(!r.ok) throw new Error("load error");
  return r.json();
})
.then(list=>{
  /* only members with valid mobile */
  members = list.filter(m =>
    m.member_id &&
    String(m.mobile||"").replace(/\D/g,"").length >= 10
  );

  document.getElementById("cnt").innerText = members.length;

  const tb=document.querySelector("#tbl tbody");
  tb.innerHTML="";

  members.forEach((m,i)=>{
    const mob = String(m.mobile).replace(/\D/g,"");
    tb.innerHTML += `
      <tr>
        <td><input type="checkbox" data-i="${i}" checked></td>
        <td>${m.name||""}</td>
        <td>${mob}</td>
        <td>${m.member_id}</td>
      </tr>`;
  });
})
.catch(()=>{
  alert("тЭМ members.json load рдирд╣реАрдВ рд╣реБрдЖ");
});

/* ===== SEND WHATSAPP ===== */
function send(){
  const tpl=document.getElementById("msg").value;
  const checked=document.querySelectorAll("input[type=checkbox]:checked");

  if(!checked.length){
    alert("тЭМ рдХреЛрдИ member select рдирд╣реАрдВ рд╣реИ");
    return;
  }

  checked.forEach(cb=>{
    const m=members[cb.dataset.i];
    const mob=String(m.mobile).replace(/\D/g,"");

    const verifyLink =
      location.origin + "/verify.html?id=" + m.member_id;

    let text = tpl
      .replaceAll("{{name}}", m.name||"")
      .replaceAll("{{id}}", m.member_id)
      .replaceAll("{{verify}}", verifyLink);

    window.open(
      "https://wa.me/91"+mob+"?text="+encodeURIComponent(text),
      "_blank"
    );
  });
}
</script>

</body>
</html>
