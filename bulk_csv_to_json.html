<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>CSV to JSON Bulk Tool | JBRRMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f4f4f4;margin:0}
.box{
  max-width:900px;margin:30px auto;
  background:#fff;padding:20px;border-radius:10px
}
h2{text-align:center;color:#7b0000;margin-top:0}
input[type=file]{margin:10px 0}
.btn{
  padding:10px 16px;background:#7b0000;
  color:#fff;border:none;border-radius:6px;
  cursor:pointer;font-size:14px
}
textarea{
  width:100%;height:300px;margin-top:15px;
  font-family:monospace;font-size:12px
}
.note{
  font-size:13px;color:#555;margin-top:12px;
  line-height:1.6
}
.warn{
  background:#fff3cd;border-left:5px solid #ff9800;
  padding:10px;font-size:13px;margin:12px 0
}
footer{
  text-align:center;font-size:13px;
  color:#555;margin:30px 0
}
</style>
</head>

<body>

<script>
/* üîê SESSION BASED ADMIN CHECK */
if(sessionStorage.getItem("admin")!=="1"){
  alert("‚ùå Unauthorized Access");
  location.href="admin_login.html";
}
</script>

<div class="box">
<h2>üìÑ CSV ‚Üí JSON Bulk Members Tool</h2>

<div class="warn">
‚ö†Ô∏è <b>Admin Use Only</b><br>
‡§Ø‡§π tool ‡§∏‡§ø‡§∞‡•ç‡§´ <b>GitHub Static Mode</b> ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•à‡•§  
Generated JSON ‡§ï‡•ã manually <b>/data/members.json</b> ‡§Æ‡•á‡§Ç paste / merge ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã‡§ó‡§æ‡•§
</div>

<p><b>Step-1:</b> CSV file upload ‡§ï‡§∞‡•á‡§Ç</p>
<input type="file" id="csv" accept=".csv">

<p><b>Step-2:</b> JSON generate ‡§ï‡§∞‡•á‡§Ç</p>
<button class="btn" onclick="parseCSV()">Generate JSON</button>

<h3>Generated JSON (Copy & Paste)</h3>
<textarea id="out" placeholder="Generated JSON will appear here‚Ä¶"></textarea>

<div class="note">
<b>CSV Header (Required ‚Äì order matter ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ):</b><br>
member_id, name, father, mobile, post, department, level, district, state, photo_url
<br><br>
‚úî Status default <b>pending</b> ‡§∞‡§π‡•á‡§ó‡§æ<br>
‚úî Duplicate <b>member_id</b> auto-skip ‡§π‡•ã‡§Ç‡§ó‡•á<br>
‚úî Final JSON ‚Üí <b>/data/members.json</b><br>
‚úî Approve ‚Üí <b>Bulk Approve Panel</b>
</div>
</div>

<script>
function clean(v){
  return (v || "").toString().trim();
}

function parseCSV(){
  const file=document.getElementById("csv").files[0];
  if(!file){
    alert("‚ùå CSV file select ‡§ï‡§∞‡•á‡§Ç");
    return;
  }

  const reader=new FileReader();
  reader.onload=e=>{
    const text=e.target.result.trim();
    const lines=text.split(/\r?\n/);

    if(lines.length<2){
      alert("‚ùå CSV ‡§Æ‡•á‡§Ç data ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à");
      return;
    }

    /* HEADER MAP */
    const headers=lines[0]
      .split(",")
      .map(h=>h.trim().toLowerCase());

    const idx=name=>headers.indexOf(name);

    if(idx("member_id")<0){
      alert("‚ùå CSV ‡§Æ‡•á‡§Ç member_id column missing ‡§π‡•à");
      return;
    }

    const usedIds=new Set();
    const result=[];
    const today=new Date().toISOString().split("T")[0];

    for(let i=1;i<lines.length;i++){
      const row=lines[i].trim();
      if(!row) continue;

      const cols=row
        .split(",")
        .map(c=>c.replace(/^"|"$/g,"").trim());

      const memberId=clean(cols[idx("member_id")]);
      if(!memberId || usedIds.has(memberId)) continue;

      usedIds.add(memberId);

      result.push({
        member_id: memberId,
        name: clean(cols[idx("name")]),
        father: clean(cols[idx("father")]),
        mobile: clean(cols[idx("mobile")]),
        post: clean(cols[idx("post")]),
        department: clean(cols[idx("department")]),
        level: clean(cols[idx("level")]),
        district: clean(cols[idx("district")]),
        state: clean(cols[idx("state")]),
        photo: clean(cols[idx("photo_url")]),
        status: "pending",
        created_at: today
      });
    }

    if(!result.length){
      alert("‚ùå Valid members ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•á");
      return;
    }

    document.getElementById("out").value=
      JSON.stringify(result,null,2);

    alert("‚úÖ JSON Generated ("+result.length+" members)");
  };

  reader.readAsText(file);
}
</script>

<footer>
¬© 2026 ‡§ú‡§Ø ‡§≠‡§µ‡§æ‡§®‡•Ä ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§∞‡§æ‡§ú‡§™‡•Ç‡§§ ‡§Æ‡§π‡§æ‡§∏‡§≠‡§æ<br>
Bulk Admin Utility ‚Äì Authorized Use Only
</footer>

</body>
</html>
