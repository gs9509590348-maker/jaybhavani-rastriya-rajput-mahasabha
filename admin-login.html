<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>JB RRMS Strong Admin Panel</title>

<style>
body{font-family:Arial;background:#f5f5f5;padding:20px}
.card{background:#fff;padding:15px;border-radius:10px;box-shadow:0 0 10px #ccc;margin:10px}
.grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
input,select,button{padding:8px;margin:5px;width:95%}
h3{margin:5px 0}
.badge{background:green;color:#fff;padding:6px;border-radius:8px}
</style>
</head>

<body>

<h2>рдЬрдп рднрд╡рд╛рдиреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рд░рд╛рдЬрдкреВрдд рдорд╣рд╛рд╕рднрд╛</h2>
<h3>ЁЯЫб Strong Admin Panel</h3>

<!-- LOGIN -->
<div id="loginBox" class="card">

<h3>тЬЙ Admin Email Login</h3>
<input id="email" placeholder="Admin Email">
<input id="password" type="password" placeholder="Password">
<button id="loginBtn">Login</button>
<p id="loginMsg"></p>

<hr>

<h3>ЁЯУ▒ Phone OTP Login</h3>
<input id="phone" placeholder="+91XXXXXXXXXX">
<div id="recaptcha-container"></div>
<button id="sendOtp">Send OTP</button>

<input id="otpCode" placeholder="Enter OTP">
<button id="verifyOtp">Verify OTP</button>
<p id="otpMsg"></p>

</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" style="display:none">

<div class="card">
<h3>ЁЯЫб Welcome Super Admin</h3>
<p>рдЖрдк Website System рдХреЛ Manage рдХрд░ рд░рд╣реЗ рд╣реИрдВ</p>
<button id="logoutBtn">Logout</button>
</div>

<div class="grid">

<!-- ADD MEMBER -->
<div class="card">
<h3>ЁЯСе рдирдпрд╛ рдореЗрдВрдмрд░ рдЬреЛрдбрд╝реЗрдВ</h3>
<input id="addName" placeholder="рдирд╛рдо">
<input id="addFather" placeholder="рдкрд┐рддрд╛ рдХрд╛ рдирд╛рдо">
<input id="addMobile" placeholder="рдореЛрдмрд╛рдЗрд▓">
<input id="addDistrict" placeholder="рдЬрд┐рд▓рд╛">
<input id="addAddress" placeholder="рдкрддрд╛">
<input id="addRole" placeholder="рдкрдж рд▓рд┐рдЦреЗрдВ (рдЬреИрд╕реЗ тАУ рдЬрд┐рд▓рд╛ рдЕрдзреНрдпрдХреНрд╖)">
<button id="addBtn">Save</button>
<p id="addMsg"></p>
</div>

<!-- EDIT MEMBER -->
<div class="card">
<h3>тЬП Member Edit / Role Assign</h3>
<input id="searchMobile" placeholder="рдореЛрдмрд╛рдЗрд▓ рд╕реЗ рд╕рд░реНрдЪ">
<button id="searchBtn">Search</button>
<hr>
<input id="editName" placeholder="рдирд╛рдо">
<input id="editFather" placeholder="рдкрд┐рддрд╛ рдХрд╛ рдирд╛рдо">
<input id="editMobile" placeholder="рдореЛрдмрд╛рдЗрд▓">
<input id="editDistrict" placeholder="рдЬрд┐рд▓рд╛">
<input id="editAddress" placeholder="рдкрддрд╛">
<input id="editRole" placeholder="рдкрдж рд▓рд┐рдЦреЗрдВ">

<input id="docId" type="hidden">

<button id="updateBtn">Update</button>

<hr>

<button id="idCardBtn">Member ID Card</button>
<button id="certificateBtn">рдкреНрд░рдорд╛рдг рдкрддреНрд░</button>
<button id="appointmentBtn">рдирд┐рдпреБрдХреНрддрд┐ рдкрддреНрд░</button>

<p id="editMsg"></p>
</div>

<!-- PENDING MEMBERS -->
<div class="card">
<h3>ЁЯЫВ Pending Member Approval</h3>
<div id="pendingList"></div>
</div>

</div>
</div>

<p>ЁЯУЮ рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди : 9166377972</p>
<p>тЬЙ Email : jbrrms1@gmail.com</p>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { 
getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut,
RecaptchaVerifier, signInWithPhoneNumber 
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { 
getFirestore, collection, addDoc, query, where, getDocs, updateDoc, doc 
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyBQpzc5xAvInmSCbzsZiy7TpD0OXVyij_4",
authDomain:"jb-rrms-membership-system.firebaseapp.com",
projectId:"jb-rrms-membership-system",
storageBucket:"jb-rrms-membership-system.firebasestorage.app",
messagingSenderId:"493815911364",
appId:"1:493815911364:web:e8f2270cf73d93dd368a91"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const ADMIN_EMAIL = "jbrrms1@gmail.com";

/******** GET ELEMENTS ********/
const loginBox = document.getElementById("loginBox");
const adminPanel = document.getElementById("adminPanel");

const email = document.getElementById("email");
const password = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const loginMsg = document.getElementById("loginMsg");

const phone = document.getElementById("phone");
const sendOtp = document.getElementById("sendOtp");
const otpCode = document.getElementById("otpCode");
const verifyOtp = document.getElementById("verifyOtp");
const otpMsg = document.getElementById("otpMsg");

const logoutBtn = document.getElementById("logoutBtn");

const addName = document.getElementById("addName");
const addFather = document.getElementById("addFather");
const addMobile = document.getElementById("addMobile");
const addDistrict = document.getElementById("addDistrict");
const addAddress = document.getElementById("addAddress");
const addRole = document.getElementById("addRole");
const addBtn = document.getElementById("addBtn");
const addMsg = document.getElementById("addMsg");

const searchMobile = document.getElementById("searchMobile");
const searchBtn = document.getElementById("searchBtn");

const editName = document.getElementById("editName");
const editFather = document.getElementById("editFather");
const editMobile = document.getElementById("editMobile");
const editDistrict = document.getElementById("editDistrict");
const editAddress = document.getElementById("editAddress");
const editRole = document.getElementById("editRole");
const updateBtn = document.getElementById("updateBtn");
const docId = document.getElementById("docId");
const editMsg = document.getElementById("editMsg");

const pendingList = document.getElementById("pendingList");

/******** EMAIL LOGIN ********/

loginBtn.onclick = ()=>{
signInWithEmailAndPassword(auth,email.value,password.value)
.then(()=>loginMsg.innerText="тЬФ Login Success")
.catch(()=>loginMsg.innerText="тЭМ Login Failed"));
};

/******** OTP LOGIN ********/

window.recaptchaVerifier = new RecaptchaVerifier(auth,'recaptcha-container',{size:"normal"});

sendOtp.onclick = ()=>{

let num = phone.value;
if(!num.startsWith("+91")) num = "+91"+num;

signInWithPhoneNumber(auth,num,window.recaptchaVerifier)
.then(r=>{window.confirmationResult=r;otpMsg.innerText="ЁЯУй OTP Sent";})
.catch(e=>otpMsg.innerText=e.message);
};

verifyOtp.onclick = ()=>{
window.confirmationResult.confirm(otpCode.value)
.then(()=>otpMsg.innerText="тЬФ OTP Verified")
.catch(e=>otpMsg.innerText=e.message);
};

/******** AUTH STATE ********/

onAuthStateChanged(auth,user=>{

if(user){

if(user.email && user.email!==ADMIN_EMAIL){
alert("Access Denied тАФ Only Admin Allowed");
signOut(auth);
return;
}

loginBox.style.display="none";
adminPanel.style.display="block";
loadPending();

}else{
loginBox.style.display="block";
adminPanel.style.display="none";
}
});

logoutBtn.onclick = ()=>signOut(auth);

/******** ADD MEMBER ********/

addBtn.onclick = async ()=>{

const q=query(collection(db,"members"),where("mobile","==",addMobile.value));
const s=await getDocs(q);
if(!s.empty){addMsg.innerText="тЭМ рдореЛрдмрд╛рдЗрд▓ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реИ";return;}

await addDoc(collection(db,"members"),{
name:addName.value,
father:addFather.value,
mobile:addMobile.value,
district:addDistrict.value,
address:addAddress.value,
role:addRole.value,
status:"pending",
memberId:"JBRRMS-"+Date.now()
});

addMsg.innerText="тЬФ Member Added (Pending)";
};

/******** SEARCH ********/

searchBtn.onclick = async ()=>{

const q=query(collection(db,"members"),where("mobile","==",searchMobile.value));
const s=await getDocs(q);
if(s.empty){editMsg.innerText="тЭМ Member рдирд╣реАрдВ рдорд┐рд▓рд╛";return;}

s.forEach(d=>{
docId.value=d.id;
let m=d.data();

editName.value=m.name;
editFather.value=m.father;
editMobile.value=m.mobile;
editDistrict.value=m.district;
editAddress.value=m.address;
editRole.value=m.role;
});

editMsg.innerText="тЬФ Member Loaded";
};

/******** UPDATE ********/

updateBtn.onclick = async ()=>{

await updateDoc(doc(db,"members",docId.value),{
name:editName.value,
father:editFather.value,
mobile:editMobile.value,
district:editDistrict.value,
address:editAddress.value,
role:editRole.value
});

editMsg.innerText="тЬФ Update Done";
};

/******** PENDING MEMBERS ********/

async function loadPending(){
pendingList.innerHTML="";
const q=query(collection(db,"members"),where("status","==","pending"));
const s=await getDocs(q);

s.forEach(d=>{
let m=d.data();

let div=document.createElement("div");
div.innerHTML=`<b>${m.name}</b> (${m.mobile})
<button onclick="approve('${d.id}')">Approve</button>
<hr>`;
pendingList.appendChild(div);
});
}

window.approve = async(id)=>{
await updateDoc(doc(db,"members",id),{status:"approved"});
alert("Approved");
loadPending();
};

/******** OPEN DOCUMENTS ********/

idCardBtn.onclick = ()=>window.open("idcard.html?id="+docId.value);
certificateBtn.onclick = ()=>window.open("certificate.html?id="+docId.value);
appointmentBtn.onclick = ()=>window.open("appointment.html?id="+docId.value);

</script>
</body>
  </html>
