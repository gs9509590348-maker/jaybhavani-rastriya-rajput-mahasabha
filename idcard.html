<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>JBRRMS ID Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{margin:0;background:#111;font-family:Arial;display:flex;flex-direction:column;align-items:center;gap:20px;padding:20px}
.card{width:1080px;height:1676px;position:relative;background-size:cover;background-position:center}
.front{background-image:url("https://ejdzdptqxelilkseannw.supabase.co/storage/v1/object/public/members/idcard_front.png")}
.back{background-image:url("https://ejdzdptqxelilkseannw.supabase.co/storage/v1/object/public/members/idcard_back.png")}

.photo{position:absolute;top:280px;left:390px;width:300px;height:380px;border-radius:20px;overflow:hidden;border:4px solid #9b0000}
.photo img{width:100%;height:100%;object-fit:cover}

.info{position:absolute;top:700px;left:140px;right:140px;font-size:34px;line-height:1.5;color:#4a1a00}
.info b{display:inline-block;width:260px}

.back-title{position:absolute;top:160px;width:100%;text-align:center;font-size:48px;font-weight:bold;color:#8b0000}
.qr{position:absolute;top:420px;left:390px;width:300px;height:300px}

button{padding:12px 24px;font-size:16px;border:none;border-radius:6px;cursor:pointer;background:#0b57d0;color:#fff}
</style>
</head>

<body>

<div id="front" class="card front">
  <div class="photo"><img id="photo"></div>
  <div class="info">
    <div><b>नाम:</b> <span id="name"></span></div>
    <div><b>पिता:</b> <span id="father_name"></span></div>
    <div><b>जिला:</b> <span id="district"></span></div>
    <div><b>राज्य:</b> <span id="state"></span></div>
    <div><b>मोबाइल:</b> <span id="mobile"></span></div>
    <div><b>Member Code:</b> <span id="member_code"></span></div>
  </div>
</div>

<button onclick="download('front')">⬇️ Download Front</button>

<div id="back" class="card back">
  <div class="back-title">जय भवानी राष्ट्रीय राजपूत महासभा</div>
  <img id="qr" class="qr">
</div>

<button onclick="download('back')">⬇️ Download Back</button>

<script>
/* SUPABASE */
const sb = supabase.createClient(
  "https://ejdzdptqxelilkseannw.supabase.co",
  "sb_publishable_iU5rrjm63ImncflRhIkQYQ_QHyDR92P"
);

/* GET CODE */
const code = new URLSearchParams(location.search).get("code");

/* LOAD DATA */
(async()=>{
  const {data,error} = await sb
    .from("JBRRMS")
    .select("*")
    .eq("member_code",code)
    .single();

  if(error || !data){
    alert("Member data नहीं मिला");
    return;
  }

  ["name","father_name","district","state","mobile","member_code"]
    .forEach(k=>document.getElementById(k).innerText=data[k]||"-");

  document.getElementById("photo").src = data.photo_url;
  document.getElementById("qr").src =
    "https://api.qrserver.com/v1/create-qr-code/?size=300x300&data="+data.member_code;
})();

/* DOWNLOAD */
function download(id){
  html2canvas(document.getElementById(id),{scale:2}).then(c=>{
    const a=document.createElement("a");
    a.download=`JBRRMS_${id}_${code}.png`;
    a.href=c.toDataURL();
    a.click();
  });
}
</script>

</body>
</html>
