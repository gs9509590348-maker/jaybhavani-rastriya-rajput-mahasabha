<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Statistics | JBRRMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#7b0000">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Arial;
  background:#f2f2f2
}
header{
  background:#7b0000;
  color:#fff;
  text-align:center;
  padding:18px 12px
}
header h1{margin:0;font-size:20px}
header p{margin:6px 0 0;font-size:13px}

.container{
  max-width:1100px;
  margin:15px auto;
  padding:12px
}

.card{
  background:#fff;
  border-radius:14px;
  padding:14px;
  margin-bottom:16px
}

h2{
  margin:0 0 10px;
  color:#7b0000;
  font-size:18px
}

/* SUMMARY */
.summary{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:10px;
  margin-bottom:16px
}
.sum{
  background:#fff;
  border-radius:12px;
  padding:12px;
  text-align:center
}
.sum b{font-size:20px;display:block}
.sum span{font-size:13px;color:#555}

/* FILTER */
.filters{
  text-align:center;
  margin-bottom:10px
}
.filters button{
  padding:6px 12px;
  margin:4px;
  border:none;
  border-radius:20px;
  background:#eee;
  font-size:13px;
  cursor:pointer
}
.filters button.active{
  background:#7b0000;
  color:#fff
}

/* CHART */
.chart-box{
  position:relative;
  width:100%;
  height:320px
}
.scroll-x{
  overflow-x:auto
}

@media(max-width:600px){
  h2{font-size:16px}
  .chart-box{height:260px}
}

.note{
  font-size:12px;
  color:#555;
  margin-top:6px
}

.loading{
  text-align:center;
  font-size:14px;
  color:#555;
  padding:20px
}

footer{
  background:#000;
  color:#fff;
  text-align:center;
  padding:12px;
  font-size:12px
}
</style>
</head>

<body>

<header>
  <h1>üìä ‡§∏‡§Ç‡§ó‡§†‡§® ‡§Ü‡§Å‡§ï‡§°‡§º‡•á</h1>
  <p>‡§ú‡§Ø ‡§≠‡§µ‡§æ‡§®‡•Ä ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§∞‡§æ‡§ú‡§™‡•Ç‡§§ ‡§Æ‡§π‡§æ‡§∏‡§≠‡§æ</p>
</header>

<div class="container">

<!-- SUMMARY -->
<div class="summary">
  <div class="sum"><b id="tTotal">0</b><span>Total</span></div>
  <div class="sum"><b id="tApproved">0</b><span>Approved</span></div>
  <div class="sum"><b id="tPending">0</b><span>Pending</span></div>
  <div class="sum"><b id="tRejected">0</b><span>Rejected</span></div>
</div>

<!-- FILTER -->
<div class="filters">
  <button class="active" onclick="setFilter('all',this)">All</button>
  <button onclick="setFilter('approved',this)">Approved</button>
  <button onclick="setFilter('pending',this)">Pending</button>
  <button onclick="setFilter('rejected',this)">Rejected</button>
</div>

<!-- STATUS -->
<div class="card">
  <h2>üìå ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§∏‡•ç‡§•‡§ø‡§§‡§ø</h2>
  <div class="chart-box">
    <canvas id="statusChart"></canvas>
  </div>
</div>

<!-- DISTRICT -->
<div class="card">
  <h2>üó∫Ô∏è ‡§ú‡§ø‡§≤‡§æ ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§∏‡§¶‡§∏‡•ç‡§Ø</h2>
  <div class="scroll-x">
    <div class="chart-box" style="min-width:600px">
      <canvas id="districtChart"></canvas>
    </div>
  </div>
  <div class="note">‚úî Top 10 districts</div>
</div>

<div class="note" id="updated"></div>
<div class="loading" id="loading">Loading data‚Ä¶</div>

</div>

<footer>
¬© 2026 JBRRMS ¬∑ Live Stats
</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
let raw=[],filter="all";
let statusChart,districtChart;

function setFilter(f,btn){
  filter=f;
  document.querySelectorAll(".filters button")
    .forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  buildCharts();
}

function loadStats(){
  document.getElementById("loading").style.display="block";
  fetch("data/members.json?v="+Date.now())
  .then(r=>r.json())
  .then(list=>{
    raw=list.filter(m=>m.member_id);
    document.getElementById("loading").style.display="none";
    buildCharts();
    document.getElementById("updated").innerText=
      "Last updated: "+new Date().toLocaleTimeString("hi-IN");
  })
  .catch(()=>{
    document.getElementById("loading").innerText="‚ùå Data load failed";
  });
}

function buildCharts(){
  let data=raw.filter(m=>{
    if(filter==="all") return true;
    return (m.status||"pending").toLowerCase()===filter;
  });

  let st={approved:0,pending:0,rejected:0};
  let dist={};

  raw.forEach(m=>{
    const s=(m.status||"pending").toLowerCase();
    st[s]=(st[s]||0)+1;
  });

  data.forEach(m=>{
    const d=(m.district||"Unknown").trim();
    dist[d]=(dist[d]||0)+1;
  });

  tTotal.innerText=raw.length;
  tApproved.innerText=st.approved||0;
  tPending.innerText=st.pending||0;
  tRejected.innerText=st.rejected||0;

  if(statusChart) statusChart.destroy();
  statusChart=new Chart(statusChartEl,{
    type:"pie",
    data:{
      labels:["Approved","Pending","Rejected"],
      datasets:[{
        data:[st.approved||0,st.pending||0,st.rejected||0],
        backgroundColor:["#28a745","#ff9800","#dc3545"]
      }]
    },
    options:{responsive:true,maintainAspectRatio:false}
  });

  const top=Object.entries(dist).sort((a,b)=>b[1]-a[1]).slice(0,10);
  if(districtChart) districtChart.destroy();
  districtChart=new Chart(districtChartEl,{
    type:"bar",
    data:{
      labels:top.map(e=>e[0]),
      datasets:[{
        label:"Members",
        data:top.map(e=>e[1]),
        backgroundColor:"#7b0000"
      }]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      scales:{y:{beginAtZero:true}}
    }
  });
}

const statusChartEl=document.getElementById("statusChart");
const districtChartEl=document.getElementById("districtChart");

loadStats();
setInterval(loadStats,60000);
</script>

</body>
</html>
