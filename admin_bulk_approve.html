<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Bulk Approve Members | Admin тАУ JBRRMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f4f4f4;margin:0}

/* HEADER */
header{
  background:#7b0000;color:#fff;
  text-align:center;padding:15px
}

/* NAVIGATION */
nav{
  background:#3b0000;
  display:flex;flex-wrap:wrap;
  justify-content:center
}
nav a{
  color:#fff;text-decoration:none;
  padding:8px 12px;font-size:14px
}
nav a:hover{background:#7b0000}

/* MAIN */
.container{
  max-width:900px;margin:20px auto;
  background:#fff;padding:20px;border-radius:10px
}
.notice{
  background:#fff3cd;border-left:5px solid #ff9800;
  padding:10px;font-size:13px;margin-bottom:15px
}
.member{
  padding:8px;border-bottom:1px solid #eee;
  display:flex;gap:8px;align-items:center
}
.member small{color:#555}
.actions{margin:15px 0;text-align:center}
button{
  padding:10px 14px;margin:5px;
  border:none;border-radius:6px;
  font-size:14px;cursor:pointer
}
.approve{background:#28a745;color:#fff}
.download{background:#7b0000;color:#fff}
.gray{background:#555;color:#fff}
.count{text-align:center;font-size:14px;margin-bottom:10px}
.no{color:#dc3545;font-weight:bold;text-align:center}

/* FOOTER */
footer{
  text-align:center;font-size:12px;
  color:#555;margin:25px 10px
}
footer a{color:#7b0000;text-decoration:none}
</style>
</head>

<body>

<script>
/* ЁЯФР ADMIN SESSION CHECK */
if(sessionStorage.getItem("admin") !== "1"){
  alert("тЭМ Unauthorized Access");
  location.href = "admin_login.html";
}
</script>

<header>
  <h2>ЁЯЪА Bulk Approve Members</h2>
  <p>Admin Panel тАУ GitHub Static Mode</p>
</header>

<nav>
  <a href="admin_dashboard.html">ЁЯПа Dashboard</a>
  <a href="admin_pending.html">тП│ Pending</a>
  <a href="admin_bulk_approve.html">ЁЯЪА Bulk Approve</a>
  <a href="admin_edit_member.html">тЬПя╕П Edit Member</a>
  <a href="admin_karyakarini.html">ЁЯзСтАНтЪЦя╕П рдХрд╛рд░реНрдпрдХрд╛рд░рд┐рдгреА</a>
  <a href="members.html" target="_blank">ЁЯзСтАНЁЯдЭтАНЁЯзС Members</a>
  <a href="verify.html" target="_blank">ЁЯФН Verify</a>
  <a href="certificate.html" target="_blank">ЁЯУЬ Certificate</a>
  <a href="idcard_print.html" target="_blank">ЁЯкк ID Card</a>
  <a href="https://jbrrms.in" target="_blank">ЁЯМР Website</a>
</nav>

<div class="container">

<div class="notice">
тЪая╕П <b>Important:</b> рдпрд╣ <b>GitHub Static Mode</b> рд╣реИред  
Approve рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж <b>Updated members.json</b> рдбрд╛рдЙрдирд▓реЛрдб рд╣реЛрдЧрд╛ред  
рдЙрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ GitHub repo рдореЗрдВ <b>same path</b> рдкрд░ replace рдХрд░рдирд╛ рдЬрд╝рд░реВрд░реА рд╣реИред
</div>

<div class="count">
Pending Members: <b id="pendingCount">0</b>
</div>

<div id="list"></div>

<div class="actions">
  <button class="approve" onclick="approveSelected()">тЬЕ Approve Selected</button>
  <button class="download" onclick="downloadJSON()">тмЗя╕П Download Updated JSON</button>
  <button class="gray" onclick="location.reload()">ЁЯФД Reload</button>
</div>

</div>

<footer>
┬й 2026 рдЬрдп рднрд╡рд╛рдиреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рд░рд╛рдЬрдкреВрдд рдорд╣рд╛рд╕рднрд╛<br>
Admin Panel тАУ Authorized Use Only
</footer>

<script>
let members = [];
const listEl = document.getElementById("list");
const pendingEl = document.getElementById("pendingCount");

/* ===== LOAD MEMBERS (CACHE SAFE) ===== */
fetch("data/members.json?v=" + Date.now())
  .then(r => {
    if(!r.ok) throw new Error("load error");
    return r.json();
  })
  .then(d => {
    if(!Array.isArray(d)) throw new Error("invalid json");
    members = d;
    render();
  })
  .catch(() => {
    listEl.innerHTML = "<p class='no'>тЭМ members.json load рдирд╣реАрдВ рд╣реБрдЖ</p>";
  });

/* ===== GET MEMBER ID ===== */
function getId(m){
  return m.id || m.member_id || m.memberId || "N/A";
}

/* ===== RENDER PENDING ===== */
function render(){
  listEl.innerHTML = "";
  let pending = 0;

  members.forEach((m,i) => {
    const status = (m.status || "pending").toLowerCase();

    if(status === "pending"){
      pending++;
      listEl.innerHTML += `
        <div class="member">
          <input type="checkbox" data-i="${i}" checked>
          <div>
            <b>${m.name || "No Name"}</b><br>
            <small>ID: ${getId(m)} ${m.post ? "| "+m.post : ""}</small>
          </div>
        </div>
      `;
    }
  });

  pendingEl.innerText = pending;

  if(pending === 0){
    listEl.innerHTML = "<p>тЬЕ рдХреЛрдИ Pending Member рдирд╣реАрдВ рд╣реИ</p>";
  }
}

/* ===== APPROVE SELECTED ===== */
function approveSelected(){
  const checks = document.querySelectorAll("input[type=checkbox]:checked");

  if(checks.length === 0){
    alert("тЭМ рдХреЛрдИ Member select рдирд╣реАрдВ рд╣реИ");
    return;
  }

  checks.forEach(c => {
    const i = parseInt(c.getAttribute("data-i"),10);
    members[i].status = "approved";
  });

  alert("тЬЕ Selected members Approved (Preview)");
  render();
}

/* ===== DOWNLOAD JSON ===== */
function downloadJSON(){
  const blob = new Blob(
    [JSON.stringify(members, null, 2)],
    {type:"application/json"}
  );
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "members.json";
  a.click();
}
</script>

</body>
</html>
