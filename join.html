```html
<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>JBRRMS Join Form</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Supabase v2 -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{font-family:Arial;background:#f4f4f4}
form{
  max-width:360px;
  background:#fff;
  margin:30px auto;
  padding:20px;
  border-radius:8px;
}
input,button{
  width:100%;
  padding:10px;
  margin:8px 0;
}
img{
  max-width:100%;
  border-radius:8px;
  margin-top:10px;
}
button{
  background:#e65100;
  color:#fff;
  border:none;
  cursor:pointer;
}
button:disabled{background:#999}
</style>
</head>

<body>

<form id="joinForm">
  <h2>JBRRMS Join Form</h2>

  <input type="text" id="name" placeholder="पूरा नाम" required>
  <input type="text" id="father_name" placeholder="पिता का नाम" required>
  <input type="text" id="district" placeholder="जिला" required>
  <input type="text" id="state" placeholder="राज्य" required>
  <input type="tel" id="mobile" placeholder="मोबाइल नंबर" pattern="[0-9]{10}" required>

  <input type="file" id="photo" accept="image/*" required>
  <img id="preview">

  <button type="submit" id="submitBtn">Submit</button>
</form>

<script>
/* ---------- CONFIG ---------- */
const { createClient } = supabase;
const supabaseClient = createClient(
  "https://ejdzdptqxelilkseannw.supabase.co",
  "sb_publishable_iU5rrjm63ImncflRhIkQYQ_QHyDR92P"
);

const CLOUD_NAME = "dlqr73p7j";
const UPLOAD_PRESET = "jbrms_unsigned";

let finalBlob = null;

/* ---------- PHOTO AUTO RESIZE ---------- */
document.getElementById("photo").addEventListener("change", async (e)=>{
  const file = e.target.files[0];
  if(!file) return;

  if(file.size > 2 * 1024 * 1024){
    alert("Photo 2MB से कम होनी चाहिए");
    e.target.value = "";
    return;
  }

  const img = new Image();
  img.src = URL.createObjectURL(file);
  await img.decode();

  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");
  canvas.width = 600;
  canvas.height = 600;

  const size = Math.min(img.width, img.height);
  const sx = (img.width - size) / 2;
  const sy = (img.height - size) / 2;

  ctx.drawImage(img, sx, sy, size, size, 0, 0, 600, 600);

  canvas.toBlob(blob=>{
    finalBlob = blob;
    document.getElementById("preview").src = URL.createObjectURL(blob);
  }, "image/jpeg", 0.8);
});

/* ---------- SUBMIT ---------- */
document.getElementById("joinForm").addEventListener("submit", async (e)=>{
  e.preventDefault();

  if(!finalBlob){
    alert("Photo process होने दें");
    return;
  }

  const btn = document.getElementById("submitBtn");
  btn.disabled = true;

  try{
    /* Cloudinary Upload */
    const fd = new FormData();
    fd.append("file", finalBlob);
    fd.append("upload_preset", UPLOAD_PRESET);

    const uploadRes = await fetch(
      `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,
      { method:"POST", body: fd }
    );

    const uploadData = await uploadRes.json();
    if(!uploadData.secure_url){
      throw new Error("Photo upload failed");
    }

    /* Supabase Insert (TABLE: JBRRMS) */
    const { error } = await supabaseClient
      .from("JBRRMS")
      .insert([{
        name: document.getElementById("name").value,
        father_name: document.getElementById("father_name").value,
        district: document.getElementById("district").value,
        state: document.getElementById("state").value,
        mobile: document.getElementById("mobile").value,
        photo_url: uploadData.secure_url,
        status: "Pending"
      }]);

    if(error) throw error;

    alert("✅ आवेदन सफल! Admin Approval के बाद ID बनेगी");
    document.getElementById("joinForm").reset();
    document.getElementById("preview").src="";
    finalBlob = null;

  }catch(err){
    alert("❌ Error: " + err.message);
  }finally{
    btn.disabled = false;
  }
});
</script>

</body>
</html>
```
