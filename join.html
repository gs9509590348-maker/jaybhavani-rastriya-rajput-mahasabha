<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>JBRRMS тАУ Royal ID Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- LIBRARIES -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{margin:0;background:#0e0e0e;font-family:Arial}

/* ===== JOIN BOX ===== */
#joinBox{
 max-width:360px;background:#fff;margin:20px auto;
 padding:18px;border-radius:12px
}
#joinBox h2{text-align:center;margin:5px 0}
input,button{
 width:100%;padding:10px;margin:6px 0;font-size:15px
}
button{
 background:#c69214;color:#fff;border:none;
 font-weight:800;border-radius:6px
}
button:disabled {
 background:#ccc; cursor:not-allowed;
}

/* ===== CARD BASE ===== */
.card{
 display:none;position:relative;
 width:1080px;height:1676px;
 margin:20px auto;background-size:cover
}
#front{
 background:url("https://ejdzdptqxelilkseannw.supabase.co/storage/v1/object/public/members/idcard_front.png") no-repeat center/cover;
}
#back{
 background:url("https://ejdzdptqxelilkseannw.supabase.co/storage/v1/object/public/members/idcard_back.png") no-repeat center/cover;
}

/* ===== TITLES ===== */
.front-title{
 position:absolute;top:415px;width:100%;
 text-align:center;font-size:56px;font-weight:900;
 background:linear-gradient(#fff2b0,#f5c542,#d4af37);
 -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.back-title{
 position:absolute;top:200px;width:100%;
 text-align:center;font-size:54px;font-weight:900;
 background:linear-gradient(#fff2b0,#f5c542,#d4af37);
 -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}

/* ===== PHOTO ===== */
.photo{
 position:absolute;top:500px;left:390px;
 width:300px;height:380px;border-radius:26px;
 overflow:hidden;border:18px solid #d4af37;
 background:#fff
}
.photo img{width:100%;height:100%;object-fit:cover}

/* ===== DETAILS ===== */
.details{
 position:absolute;top:930px;padding-left:280px;
 font-size:52px;line-height:1.6;color:#000
}
#c_code{margin-top:14px;font-weight:900;letter-spacing:3px}

/* ===== BACK SIDE ===== */
#qr{
 position:absolute;top:380px;left:50%;
 transform:translateX(-50%)
}
.seven-lines{
 position:absolute;top:720px;left:50%;
 transform:translateX(-50%);
 width:760px;text-align:center;
 font-size:22px;font-weight:600
}
.back-footer{
 position:absolute;bottom:120px;width:100%;
 text-align:center;font-size:26px
}
.disclaimer{
 position:absolute;bottom:40px;width:100%;
 text-align:center;font-size:20px;opacity:.85
}

/* ===== ACTIONS ===== */
.actions{text-align:center;margin:20px}
.actions button{width:180px;margin:6px}
</style>
</head>

<body>

<!-- JOIN FORM -->
<div id="joinBox">
<h2>JBRRMS Join / Search</h2>

<input id="name" placeholder="рдкреВрд░рд╛ рдирд╛рдо *">
<input id="father" placeholder="рдкрд┐рддрд╛ рдХрд╛ рдирд╛рдо">
<input id="post" placeholder="рдкрдж">
<input id="district" placeholder="рдЬрд┐рд▓рд╛">
<input id="state" placeholder="рд░рд╛рдЬреНрдп">
<input id="mobile" placeholder="рдореЛрдмрд╛рдЗрд▓">
<input type="file" id="photoInput" accept="image/*">

<button id="joinButton" onclick="joinNow()">Join Now</button>
<hr>
<input id="searchCode" placeholder="Member Code (JBRRMS0001)">
<button id="searchButton" onclick="searchMember()">ЁЯЖФ Search ID Card</button>
</div>

<!-- FRONT -->
<div id="front" class="card">
<div class="front-title">рдЬрдп рднрд╡рд╛рдиреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рд░рд╛рдЬрдкреВрдд рдорд╣рд╛рд╕рднрд╛</div>
<div class="photo"><img id="photo"></div>
<div class="details">
<div><b>рдирд╛рдо :</b> <span id="c_name"></span></div>
<div><b>рдкрдж :</b> <span id="c_post"></span></div>
<div><b>рдкрд┐рддрд╛ :</b> <span id="c_father"></span></div>
<div><b>рдЬрд┐рд▓рд╛ :</b> <span id="c_district"></span></div>
<div><b>рд░рд╛рдЬреНрдп :</b> <span id="c_state"></span></div>
<div><b>рдореЛрдмрд╛рдЗрд▓ :</b> <span id="c_mobile"></span></div>
<div id="c_code"></div>
</div>
</div>

<!-- BACK -->
<div id="back" class="card">
<div class="back-title">рдЬрдп рднрд╡рд╛рдиреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рд░рд╛рдЬрдкреВрдд рдорд╣рд╛рд╕рднрд╛</div>

<div id="qr"></div>

<div class="seven-lines">
рдкрдж рд╕реЗ рдмрдбрд╝рд╛ рд╕реНрд╡рд╛рднрд┐рдорд╛рди рд╣реИред<br>
рд╕реНрд╡рд╛рднрд┐рдорд╛рди рд╣реИ рддреЛ рдкрд╣рдЪрд╛рди рд╣реИред<br>
рд╕реНрд╡рд╛рднрд┐рдорд╛рди рдХрднреА рдЧрд┐рд░рд╡реА рдирд╣реАрдВ рд░рдЦрд╛ рдЬрд╛рддрд╛ред<br>
рд╕реНрд╡рд╛рднрд┐рдорд╛рди рд╣реА рдЕрд╕рд▓реА рд╢рдХреНрддрд┐ рд╣реИред<br>
рдЬрд┐рд╕рдХреЗ рдкрд╛рд╕ рд╕реНрд╡рд╛рднрд┐рдорд╛рди рд╣реИ, рд╡рд╣реА рд╕рдЪреНрдЪрд╛ рдмрд▓рд╡рд╛рди рд╣реИред<br>
рд╕реНрд╡рд╛рднрд┐рдорд╛рди рд╕рдордЭреМрддрд╛ рдирд╣реАрдВ рд╕рд┐рдЦрд╛рддрд╛ред<br>
рд╕реНрд╡рд╛рднрд┐рдорд╛рди рд╣рдорд╛рд░реА рдЕрд╕рд▓реА рд╡рд┐рд░рд╛рд╕рдд рд╣реИред
</div>

<div class="back-footer">
рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди: 9166377972<br>
Email: jbrrms1@gmail.com<br>
Website: www.jbrrms.in
</div>

<div class="disclaimer">
рдпрд╣ рдкрд╣рдЪрд╛рди рдкрддреНрд░ рд╕рдВрдЧрдардирд╛рддреНрдордХ рдкреНрд░рдпреЛрдЬрдиреЛрдВ рд╣реЗрддреБ рд╣реИред рдХрд┐рд╕реА рднреА рд╕рд░рдХрд╛рд░реА рдкрд╣рдЪрд╛рди рдХрд╛ рд╡рд┐рдХрд▓реНрдк рдирд╣реАрдВ рд╣реИред
</div>
</div>

<div class="actions">
<button onclick="showFront()">тмЕ Front</button>
<button onclick="showBack()">Back тЮб</button>
<button onclick="download()">тмЗ Download</button>
</div>

<script>
// Replace with your actual Supabase anon key (starts with 'eyJ...')
const SUPABASE_URL = "https://ejdzdptqxelilkseannw.supabase.co";
const SUPABASE_ANON_KEY = "YOUR_ACTUAL_ANON_KEY_HERE";  // Paste the full key from Supabase dashboard

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let blob = null, side = "front";

photoInput.onchange = e => {
  const img = new Image();
  img.src = URL.createObjectURL(e.target.files[0]);
  img.onload = () => {
    const c = document.createElement("canvas");
    c.width = c.height = 600;
    const x = c.getContext("2d");
    const s = Math.min(img.width, img.height);
    x.drawImage(img, (img.width - s) / 2, (img.height - s) / 2, s, s, 0, 0, 600, 600);
    c.toBlob(b => blob = b, "image/jpeg", 0.9);
  }
}

async function joinNow() {
  const button = document.getElementById("joinButton");
  button.disabled = true;
  button.innerText = "Processing...";

  try {
    if (!name.value.trim()) throw new Error("рдирд╛рдо рдЬрд░реВрд░реА рд╣реИ");
    if (!blob) throw new Error("Photo рдЬрд░реВрд░реА рд╣реИ");
    if (mobile.value && !/^\d{10}$/.test(mobile.value.trim())) throw new Error("10 рдЕрдВрдХреЛрдВ рдХрд╛ рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ рдбрд╛рд▓реЗрдВ");

    const fd = new FormData();
    fd.append("file", blob);
    fd.append("upload_preset", "jbrms_unsigned");  // Note: For production, consider signed uploads for security

    const up = await fetch("https://api.cloudinary.com/v1_1/dlqr73p7j/image/upload", { method: "POST", body: fd });
    if (!up.ok) throw new Error("Photo upload failed: " + up.statusText);
    const img = await up.json();
    if (!img.secure_url) throw new Error("Photo upload failed");

    const { data, error } = await sb.from("JBRRMS").insert([{
      name: name.value.trim(),
      father_name: father.value.trim(),
      post: post.value.trim(),
      district: district.value.trim(),
      state: state.value.trim(),
      mobile: mobile.value.trim(),
      photo_url: img.secure_url
    }]).select("member_code").single();

    if (error) throw new Error(error.message);
    alert("Join рд╕рдлрд▓ тЬФя╕П\nMember Code: " + data.member_code);

    // Clear form after success
    name.value = father.value = post.value = district.value = state.value = mobile.value = "";
    photoInput.value = "";
    blob = null;
  } catch (err) {
    alert(err.message);
  } finally {
    button.disabled = false;
    button.innerText = "Join Now";
  }
}

async function searchMember() {
  const button = document.getElementById("searchButton");
  button.disabled = true;
  button.innerText = "Searching...";

  try {
    const code = searchCode.value.trim();
    if (!code) throw new Error("Member Code рдбрд╛рд▓реЗрдВ");

    const { data, error } = await sb.from("JBRRMS").select("*").eq("member_code", code).single();
    if (error) throw new Error(error.message);
    if (!data) throw new Error("Member not found");

    joinBox.style.display = "none";
    front.style.display = "block";
    back.style.display = "none";

    c_name.innerText = data.name;
    c_post.innerText = data.post || "";
    c_father.innerText = data.father_name || "";
    c_district.innerText = data.district || "";
    c_state.innerText = data.state || "";
    c_mobile.innerText = data.mobile || "";
    c_code.innerText = data.member_code;
    photo.src = data.photo_url;

    qr.innerHTML = "";
    new QRCode(qr, { text: data.member_code, width: 300, height: 300 });
  } catch (err) {
    alert(err.message);
  } finally {
    button.disabled = false;
    button.innerText = "ЁЯЖФ Search ID Card";
  }
}

function showFront() { front.style.display = "block"; back.style.display = "none"; side = "front" }
function showBack() { front.style.display = "none"; back.style.display = "block"; side = "back" }

function download() {
  const el = side === "front" ? front : back;
  html2canvas(el, { scale: 2, useCORS: true }).then(c => {
    const a = document.createElement("a");
    a.download = "JBRRMS_" + side + "_ID.png";
    a.href = c.toDataURL("image/png", 1);
    a.click();
  });
}
</script>

</body>
</html>
