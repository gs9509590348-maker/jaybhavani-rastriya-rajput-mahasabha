<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>рдЬрдп рднрд╡рд╛рдиреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рд░рд╛рдЬрдкреВрдд рдорд╣рд╛рд╕рднрд╛ тАУ Digital System</title>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  font-family:Mangal,Arial;
  background:#f2f2f2;
  margin:0;
  padding:10px
}
input,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:16px
}
button{
  background:#8b0000;
  color:#fff;
  border:none;
  border-radius:6px
}
canvas{
  width:100%;
  max-width:1080px;
  border:2px solid #aaa;
  margin-top:10px;
  background:#fff
}
.section{
  background:#fff;
  padding:10px;
  border-radius:8px;
  margin-bottom:10px
}
</style>
</head>

<body>

<h2 align="center">рдЬрдп рднрд╡рд╛рдиреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рд░рд╛рдЬрдкреВрдд рдорд╣рд╛рд╕рднрд╛</h2>

<div class="section">
<h3>ЁЯУЭ рд╕рджрд╕реНрдп рдЬреНрд╡рд╛рдЗрди рдлреЙрд░реНрдо</h3>
<input id="name" placeholder="рдирд╛рдо">
<input id="fname" placeholder="рдкрд┐рддрд╛ рдХрд╛ рдирд╛рдо">
<input id="mobile" placeholder="рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░">
<input id="district" placeholder="рдЬрд┐рд▓рд╛">
<input id="state" placeholder="рд░рд╛рдЬреНрдп">
<input id="member" placeholder="Member Code (JBRRMS0001)">
<input type="file" id="photo" accept="image/*">
<button onclick="generateAll()">Certificate + ID Card Generate</button>
</div>

<canvas id="certificate" width="1080" height="1678"></canvas>
<canvas id="idfront" width="540" height="856"></canvas>
<canvas id="idback" width="540" height="856"></canvas>

<div class="section">
<button onclick="downloadPNG('certificate')">ЁЯУе Certificate PNG</button>
<button onclick="downloadPNG('idfront')">ЁЯУе ID Card Front</button>
<button onclick="downloadPNG('idback')">ЁЯУе ID Card Back</button>
<button onclick="downloadPDF()">ЁЯУД Complete PDF</button>
</div>

<script>
const certBG = new Image(); certBG.src="certificate.png";
const idFront = new Image(); idFront.src="idcard_front.png";
const idBack  = new Image(); idBack.src="idcard_back.png";
const logo    = new Image(); logo.src="logo.png";

CanvasRenderingContext2D.prototype.roundRect =
CanvasRenderingContext2D.prototype.roundRect ||
function(x,y,w,h,r){
 this.moveTo(x+r,y);
 this.arcTo(x+w,y,x+w,y+h,r);
 this.arcTo(x+w,y+h,x,y+h,r);
 this.arcTo(x,y+h,x,y,r);
 this.arcTo(x,y,x+w,y,r);
};

function generateAll(){
 if(!name.value || !member.value){
  alert("рдирд╛рдо рдФрд░ Member Code рдЕрдирд┐рд╡рд╛рд░реНрдп рд╣реИ");
  return;
 }
 generateCertificate();
 generateID();
}

/* ================= CERTIFICATE (NO PHOTO) ================= */
function generateCertificate(){
 const c = certificate.getContext("2d");
 c.clearRect(0,0,1080,1678);

 c.drawImage(certBG,0,0,1080,1678);
 c.drawImage(logo,390,40,300,300);

 c.font="bold 60px serif";
 c.fillStyle="#7a0000";
 c.textAlign="center";
 c.fillText("рдкреНрд░рдорд╛рдг рдкрддреНрд░",540,430);

 c.font="30px serif";
 c.fillStyle="#000";
 c.textAlign="left";

 let y=560,g=55;
 line("рдирд╛рдо",name.value);
 line("рдкрд┐рддрд╛ рдХрд╛ рдирд╛рдо",fname.value);
 line("рдореЛрдмрд╛рдЗрд▓",mobile.value);
 line("рдЬрд┐рд▓рд╛",district.value);
 line("рд░рд╛рдЬреНрдп",state.value);
 line("рд╕рджрд╕реНрдп рдХреЛрдб",member.value);

 function line(l,v){
  c.fillText(l+" :",200,y);
  c.textAlign="right";
  c.fillText(v,880,y);
  c.textAlign="left";
  y+=g;
 }

 /* LEFT INFO */
 c.save();
 c.translate(70,1200);
 c.rotate(-Math.PI/2);
 c.font="22px serif";
 c.fillStyle="#333";
 c.fillText("рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди : 9166377972",0,0);
 c.fillText("рдИрдореЗрд▓ : jbrrms1@gmail.com",0,35);
 c.fillText("рд╡реЗрдмрд╕рд╛рдЗрдЯ : www.jbrrms.in",0,70);
 c.restore();

 /* RIGHT QR тАУ DIRECT WEBSITE */
 drawQR(c,760,980,qrURL());

 /* DISCLAIMER */
 c.font="18px serif";
 c.textAlign="center";
 c.fillStyle="#444";
 c.fillText(
  "рдпрд╣ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреЗрд╡рд▓ рд╕рдВрдЧрдардирд╛рддреНрдордХ рдкрд╣рдЪрд╛рди рд╣реЗрддреБ рд╣реИред рдЗрд╕рдХрд╛ рдХрд┐рд╕реА рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рд░рдХрд╛рд░реА рдЕрдерд╡рд╛ рдХрд╛рдиреВрдиреА рдЕрдзрд┐рдХрд╛рд░ рд╕реЗ рдХреЛрдИ рд╕рдВрдмрдВрдз рдирд╣реАрдВ рд╣реИред",
  540,1600
 );
}

/* ================= ID CARD ================= */
function generateID(){
 const f=idfront.getContext("2d");
 f.clearRect(0,0,540,856);
 f.drawImage(idFront,0,0,540,856);

 drawPhotoCover(f,150,260,240,300);

 f.font="20px serif";
 f.fillStyle="#000";
 f.fillText(name.value,140,610);
 f.fillText(member.value,140,645);
 f.fillText(district.value,140,680);

 const b=idback.getContext("2d");
 b.clearRect(0,0,540,856);
 b.drawImage(idBack,0,0,540,856);

 drawQR(b,150,260,qrURL());
}

/* ===== PHOTO AUTO FIT ===== */
function drawPhotoCover(ctx,x,y,w,h){
 const file=photo.files[0];
 if(!file) return;
 const img=new Image();
 img.onload=()=>{
  const ir=img.width/img.height, cr=w/h;
  let sx,sy,sw,sh;
  if(ir>cr){ sh=img.height; sw=sh*cr; sx=(img.width-sw)/2; sy=0;}
  else{ sw=img.width; sh=sw/cr; sx=0; sy=(img.height-sh)/2;}
  ctx.save();
  ctx.beginPath();
  ctx.roundRect(x,y,w,h,20);
  ctx.clip();
  ctx.drawImage(img,sx,sy,sw,sh,x,y,w,h);
  ctx.restore();
 };
 img.src=URL.createObjectURL(file);
}

/* ===== QR DIRECT WEBSITE ===== */
function qrURL(){
 return "https://www.jbrrms.in/?member="+encodeURIComponent(member.value);
}

function drawQR(ctx,x,y,text){
 QRCode.toCanvas(document.createElement("canvas"),text,{width:240},(e,qr)=>{
  ctx.drawImage(qr,x,y);
 });
}

/* ===== DOWNLOAD ===== */
function downloadPNG(id){
 const c=document.getElementById(id);
 const a=document.createElement("a");
 a.href=c.toDataURL("image/png");
 a.download=member.value+"_"+id+".png";
 a.click();
}

function downloadPDF(){
 const {jsPDF}=window.jspdf;
 const pdf=new jsPDF("p","px",[1080,1678]);
 pdf.addImage(certificate.toDataURL(),"PNG",0,0,1080,1678);
 pdf.addPage([540,856],"p");
 pdf.addImage(idfront.toDataURL(),"PNG",0,0,540,856);
 pdf.addPage([540,856],"p");
 pdf.addImage(idback.toDataURL(),"PNG",0,0,540,856);
 pdf.save(member.value+"_JB_RRMS.pdf");
}
</script>

</body>
</html>
