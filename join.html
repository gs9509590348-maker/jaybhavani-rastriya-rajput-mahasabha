<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Join - JB RRMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:system-ui;background:#f3f3f3;text-align:center;padding:10px}
.card{background:#fff;padding:15px;border-radius:12px;max-width:420px;margin:auto;
box-shadow:0 2px 6px rgba(0,0,0,.2)}
input{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc}
button{width:100%;padding:12px;border:none;border-radius:8px;background:#d92323;
color:#fff;font-size:16px}
.logo{width:90px;margin-bottom:8px}
</style>
</head>

<body>

<img class="logo" src="logo.png">

<h2>рдЬрдп рднрд╡рд╛рдиреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рд░рд╛рдЬрдкреВрдд рдорд╣рд╛рд╕рднрд╛</h2>
<h3>ЁЯУЭ рд╕рджрд╕реНрдп рдкрдВрдЬреАрдХрд░рдг рдлреЙрд░реНрдо</h3>

<div class="card">

<input id="name" placeholder="рдкреВрд░рд╛ рдирд╛рдо рджрд░реНрдЬ рдХрд░реЗрдВ">
<input id="father" placeholder="рдкрд┐рддрд╛ рдХрд╛ рдирд╛рдо рджрд░реНрдЬ рдХрд░реЗрдВ">
<input id="mobile" placeholder="рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░" maxlength="10">
<input id="state" placeholder="рд░рд╛рдЬреНрдп (State)">
<input id="address" placeholder="рдкреВрд░рд╛ рдкрддрд╛">
<input id="photo" placeholder="рдлреЛрдЯреЛ рд▓рд┐рдВрдХ (Google Drive / Link)">

<button id="joinBtn">Submit</button>

<p id="msg" style="font-weight:600;"></p>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, query, where, getDocs } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
 apiKey:"AIzaSyBQpzc5xAvInmSCbzsZiy7TpD0OXVyij_4",
 authDomain:"jb-rrms-membership-system.firebaseapp.com",
 projectId:"jb-rrms-membership-system",
 storageBucket:"jb-rrms-membership-system.appspot.com",
 messagingSenderId:"493815911364",
 appId:"1:493815911364:web:e8f2270cf73d93dd368a91"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

document.getElementById("joinBtn").onclick = async ()=>{

 const name = document.getElementById("name").value.trim();
 const father = document.getElementById("father").value.trim();
 const mobile = document.getElementById("mobile").value.trim();
 const state = document.getElementById("state").value.trim();
 const address = document.getElementById("address").value.trim();
 const photo = document.getElementById("photo").value.trim();
 const msg = document.getElementById("msg");

 const role = "рд╕рджрд╕реНрдп";

 if(name=="" || father=="" || mobile=="" || state=="" || address==""){
  alert("рдХреГрдкрдпрд╛ рд╕рднреА рд╡рд┐рд╡рд░рдг рднрд░реЗрдВ");
  return;
 }

 if(mobile.length!=10){
  alert("рд╕рд╣реА рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ рджрд░реНрдЬ рдХрд░реЗрдВ");
  return;
 }

 msg.style.color="blue";
 msg.innerText="рдХреГрдкрдпрд╛ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ...";

 try {

  const q1 = query(collection(db,"approved_members"), where("mobile","==",mobile));
  const r1 = await getDocs(q1);

  const q2 = query(collection(db,"pending_members"), where("mobile","==",mobile));
  const r2 = await getDocs(q2);

  if(!r1.empty || !r2.empty){
   msg.style.color="red";
   msg.innerText="рдпрд╣ рдореЛрдмрд╛рдЗрд▓ рдкрд╣рд▓реЗ рд╕реЗ Registered рд╣реИ ЁЯЪл";
   return;
  }

  await addDoc(collection(db,"pending_members"),{
   name,
   father,
   mobile,
   state,
   address,
   photo,
   role,
   status:"pending",
   created:new Date()
  });

  msg.style.color="green";
  msg.innerText="рдЖрдкрдХрд╛ рдлреЙрд░реНрдо рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд╕рдмрдорд┐рдЯ рд╣реЛ рдЧрдпрд╛ рд╣реИ ЁЯЩП";

 } catch(e){
  msg.style.color="red";
  msg.innerText="рд╕рдмрдорд┐рдЯ рдХрд░рддреЗ рд╕рдордп рд╕рдорд╕реНрдпрд╛ рдЖрдИ тЭМ";
 }

};

</script>

</body>
</html>
