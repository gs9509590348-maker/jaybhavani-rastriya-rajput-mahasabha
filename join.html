<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>JBRRMS ‚Äì Royal ID Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- LIBRARIES -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{margin:0;background:#0e0e0e;font-family:Arial}

/* JOIN BOX */
#joinBox{
 max-width:360px;background:#fff;margin:20px auto;
 padding:18px;border-radius:12px
}
#joinBox h2{text-align:center;margin:5px 0}
input,button{width:100%;padding:10px;margin:6px 0;font-size:15px}
button{
 background:#c69214;color:#fff;border:none;
 font-weight:800;border-radius:6px
}

/* CARD */
.card{
 display:none;position:relative;
 width:1080px;height:1676px;
 margin:20px auto;background-size:cover
}
#front{
 background:url("https://ejdzdptqxelilkseannw.supabase.co/storage/v1/object/public/members/idcard_front.png") no-repeat center/cover;
}
#back{
 background:url("https://ejdzdptqxelilkseannw.supabase.co/storage/v1/object/public/members/idcard_back.png") no-repeat center/cover;
}

/* TITLES */
.front-title,.back-title{
 position:absolute;width:100%;text-align:center;
 font-weight:900;
 background:linear-gradient(#fff2b0,#f5c542,#d4af37);
 -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.front-title{top:415px;font-size:56px}
.back-title{top:200px;font-size:54px}

/* PHOTO */
.photo{
 position:absolute;top:500px;left:390px;
 width:300px;height:380px;border-radius:26px;
 overflow:hidden;border:18px solid #d4af37;
 background:#fff
}
.photo img{width:100%;height:100%;object-fit:cover}

/* DETAILS */
.details{
 position:absolute;top:930px;padding-left:280px;
 font-size:52px;line-height:1.6;color:#000
}
#c_code{margin-top:14px;font-weight:900;letter-spacing:3px}

/* BACK */
#qr{
 position:absolute;top:380px;left:50%;
 transform:translateX(-50%)
}
.seven-lines{
 position:absolute;top:720px;left:50%;
 transform:translateX(-50%);
 width:700px;text-align:center;
 font-size:20px;line-height:1.45;color:#000
}
.back-footer{
 position:absolute;bottom:120px;width:100%;
 text-align:center;font-size:26px
}
.disclaimer{
 position:absolute;bottom:40px;width:100%;
 text-align:center;font-size:20px;opacity:.85
}

/* ACTIONS */
.actions{text-align:center;margin:20px}
.actions button{width:180px;margin:6px}
</style>
</head>

<body>

<!-- JOIN -->
<div id="joinBox">
<h2>JBRRMS Join / Search</h2>
<input id="name" placeholder="‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ *">
<input id="father" placeholder="‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ">
<input id="district" placeholder="‡§ú‡§ø‡§≤‡§æ">
<input id="state" placeholder="‡§∞‡§æ‡§ú‡•ç‡§Ø">
<input id="mobile" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤">
<input type="file" id="photoInput" accept="image/*">
<button onclick="joinNow()">Join Now</button>
<hr>
<input id="searchCode" placeholder="Member Code (JBRRMS0001)">
<button onclick="searchMember()">üÜî Search ID Card</button>
</div>

<!-- FRONT -->
<div id="front" class="card">
<div class="front-title">‡§ú‡§Ø ‡§≠‡§µ‡§æ‡§®‡•Ä ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§∞‡§æ‡§ú‡§™‡•Ç‡§§ ‡§Æ‡§π‡§æ‡§∏‡§≠‡§æ</div>
<div class="photo"><img id="photo"></div>
<div class="details">
<div><b>‡§®‡§æ‡§Æ :</b> <span id="c_name"></span></div>
<div><b>‡§™‡§ø‡§§‡§æ :</b> <span id="c_father"></span></div>
<div><b>‡§ú‡§ø‡§≤‡§æ :</b> <span id="c_district"></span></div>
<div><b>‡§∞‡§æ‡§ú‡•ç‡§Ø :</b> <span id="c_state"></span></div>
<div><b>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ :</b> <span id="c_mobile"></span></div>
<div id="c_code"></div>
</div>
</div>

<!-- BACK -->
<div id="back" class="card">
<div class="back-title">‡§ú‡§Ø ‡§≠‡§µ‡§æ‡§®‡•Ä ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§∞‡§æ‡§ú‡§™‡•Ç‡§§ ‡§Æ‡§π‡§æ‡§∏‡§≠‡§æ</div>
<div id="qr"></div>

<div class="seven-lines">
‡§™‡§¶ ‡§∏‡•á ‡§¨‡§°‡§º‡§æ ‡§∏‡•ç‡§µ‡§æ‡§≠‡§ø‡§Æ‡§æ‡§® ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§<br>
‡§∏‡•ç‡§µ‡§æ‡§≠‡§ø‡§Æ‡§æ‡§® ‡§π‡•à ‡§§‡•ã ‡§™‡§π‡§ö‡§æ‡§® ‡§π‡•à‡•§<br>
‡§∏‡•ç‡§µ‡§æ‡§≠‡§ø‡§Æ‡§æ‡§® ‡§ï‡§≠‡•Ä ‡§ó‡§ø‡§∞‡§µ‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§∞‡§ñ‡§æ ‡§ú‡§æ‡§§‡§æ‡•§<br>
‡§∏‡•ç‡§µ‡§æ‡§≠‡§ø‡§Æ‡§æ‡§® ‡§π‡•Ä ‡§Ö‡§∏‡§≤‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø ‡§π‡•à‡•§<br>
‡§ú‡§ø‡§∏‡§ï‡•á ‡§™‡§æ‡§∏ ‡§∏‡•ç‡§µ‡§æ‡§≠‡§ø‡§Æ‡§æ‡§® ‡§π‡•à, ‡§µ‡§π‡•Ä ‡§∏‡§ö‡•ç‡§ö‡§æ ‡§¨‡§≤‡§µ‡§æ‡§® ‡§π‡•à‡•§<br>
‡§∏‡•ç‡§µ‡§æ‡§≠‡§ø‡§Æ‡§æ‡§® ‡§∏‡§Æ‡§ù‡•å‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§∏‡§ø‡§ñ‡§æ‡§§‡§æ‡•§<br>
‡§∏‡•ç‡§µ‡§æ‡§≠‡§ø‡§Æ‡§æ‡§® ‡§π‡§Æ‡§æ‡§∞‡•Ä ‡§Ö‡§∏‡§≤‡•Ä ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§π‡•à‡•§
</div>

<div class="back-footer">
‡§π‡•á‡§≤‡•ç‡§™‡§≤‡§æ‡§á‡§®: 9166377972<br>
Email: jbrrms1@gmail.com<br>
Website: www.jbrrms.in
</div>
<div class="disclaimer">
‡§Ø‡§π ‡§™‡§π‡§ö‡§æ‡§® ‡§™‡§§‡•ç‡§∞ ‡§∏‡§Ç‡§ó‡§†‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ú‡§®‡•ã‡§Ç ‡§π‡•á‡§§‡•Å ‡§π‡•à‡•§
</div>
</div>

<div class="actions">
<button onclick="showFront()">‚¨Ö Front</button>
<button onclick="showBack()">Back ‚û°</button>
<button onclick="download()">‚¨á Download</button>
</div>

<script>
const sb = supabase.createClient(
 "https://ejdzdptqxelilkseannw.supabase.co",
 "PASTE_YOUR_ANON_KEY"
);

/* ELEMENTS */
const name = document.getElementById("name");
const father = document.getElementById("father");
const district = document.getElementById("district");
const state = document.getElementById("state");
const mobile = document.getElementById("mobile");
const photoInput = document.getElementById("photoInput");
const searchCode = document.getElementById("searchCode");

const joinBox = document.getElementById("joinBox");
const front = document.getElementById("front");
const back = document.getElementById("back");

const c_name = document.getElementById("c_name");
const c_father = document.getElementById("c_father");
const c_district = document.getElementById("c_district");
const c_state = document.getElementById("c_state");
const c_mobile = document.getElementById("c_mobile");
const c_code = document.getElementById("c_code");
const photo = document.getElementById("photo");
const qr = document.getElementById("qr");

let photoBlob = null;
let side = "front";

/* PHOTO CROP */
photoInput.onchange = e => {
 const img = new Image();
 img.src = URL.createObjectURL(e.target.files[0]);
 img.onload = () => {
  const c = document.createElement("canvas");
  c.width = c.height = 600;
  const ctx = c.getContext("2d");
  const s = Math.min(img.width, img.height);
  ctx.drawImage(img,(img.width-s)/2,(img.height-s)/2,s,s,0,0,600,600);
  c.toBlob(b => photoBlob = b, "image/jpeg", 0.9);
 };
};

/* JOIN */
async function joinNow(){
 if(!name.value || !photoBlob){
  alert("‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§´‡•ã‡§ü‡•ã ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à");
  return;
 }

 const fd = new FormData();
 fd.append("file", photoBlob);
 fd.append("upload_preset", "jbrms_unsigned");

 const up = await fetch(
  "https://api.cloudinary.com/v1_1/dlqr73p7j/image/upload",
  { method:"POST", body: fd }
 );
 const img = await up.json();

 const { data, error } = await sb
  .from("JBRRMS")
  .insert([{
    name: name.value,
    father_name: father.value,
    district: district.value,
    state: state.value,
    mobile: mobile.value,
    photo_url: img.secure_url
  }])
  .select("member_code")
  .single();

 if(error){
  alert(error.message);
  return;
 }

 alert("Join Successful ‚úÖ\nMember Code: " + data.member_code);
 searchCode.value = data.member_code;
 searchMember();
}

/* SEARCH */
async function searchMember(){
 if(!searchCode.value) return;

 const { data, error } = await sb
  .from("JBRRMS")
  .select("*")
  .eq("member_code", searchCode.value)
  .single();

 if(error){
  alert("Member not found");
  return;
 }

 joinBox.style.display="none";
 front.style.display="block";
 back.style.display="none";

 c_name.innerText = data.name;
 c_father.innerText = data.father_name || "";
 c_district.innerText = data.district || "";
 c_state.innerText = data.state || "";
 c_mobile.innerText = data.mobile || "";
 c_code.innerText = data.member_code;
 photo.src = data.photo_url;

 qr.innerHTML="";
 new QRCode(qr,{text:data.member_code,width:300,height:300});
}

/* VIEW */
function showFront(){front.style.display="block";back.style.display="none";side="front"}
function showBack(){front.style.display="none";back.style.display="block";side="back"}

/* DOWNLOAD */
function download(){
 html2canvas(side==="front"?front:back,{scale:2,useCORS:true})
 .then(c=>{
  const a=document.createElement("a");
  a.href=c.toDataURL("image/png");
  a.download="JBRRMS_"+side+".png";
  a.click();
 });
}
</script>

</body>
</html>
