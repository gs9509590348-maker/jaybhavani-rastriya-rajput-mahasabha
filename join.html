<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>рд╕рджрд╕реНрдп рдкрдВрдЬреАрдХрд░рдг рдлреЙрд░реНрдо</title>

<style>
body{font-family:Arial;background:#f5f5f5}
.box{max-width:500px;margin:20px auto;background:#fff;padding:20px;border-radius:10px}
input,button,select{width:100%;padding:10px;margin:7px 0}
button{background:#c72e1f;color:#fff;border:0;font-size:16px;border-radius:8px}
</style>
</head>

<body>

<div class="box">

<h3 style="text-align:center;color:#c72e1f;">
ЁЯЪй рдЬрдп рднрд╡рд╛рдиреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рд░рд╛рдЬрдкреВрдд рдорд╣рд╛рд╕рднрд╛ ЁЯЪй<br>
ЁЯУЭ рд╕рджрд╕реНрдп рдкрдВрдЬреАрдХрд░рдг рдлреЙрд░реНрдо
</h3>

<form id="joinForm">

<input type="text" id="name" placeholder="рдкреВрд░рд╛ рдирд╛рдо*" required>

<input type="text" id="father" placeholder="рдкрд┐рддрд╛ рдХрд╛ рдирд╛рдо*" required>

<input type="tel" id="mobile" placeholder="рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░*" maxlength="10" pattern="[0-9]{10}" required>

<input type="text" id="address" placeholder="рдкреВрд░рд╛ рдкрддрд╛*" required>

<input type="text" id="district" placeholder="рдЬрд┐рд▓рд╛*" required>

<select id="state" required>
<option value="">рд░рд╛рдЬреНрдп рдЪреБрдиреЗрдВ *</option>
<option>Rajasthan</option>
<option>Uttar Pradesh</option>
<option>Madhya Pradesh</option>
<option>Gujarat</option>
<option>Maharashtra</option>
<option>Haryana</option>
<option>Delhi</option>
<option>Bihar</option>
<option>Punjab</option>
<option>Other</option>
</select>

<label>ЁЯУ╕ рдкрд╛рд╕рдкреЛрд░реНрдЯ рд╕рд╛рдЗрдЬ рдлреЛрдЯреЛ *</label>
<input type="file" id="photo" accept="image/*" required>

<button id="submitBtn" type="submit">Submit</button>

</form>

</div>


<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, addDoc, Timestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBQpzc5xAvInmSCbzsZiy7TpD0OXVyij_4",
  authDomain: "jb-rrms-membership-system.firebaseapp.com",
  projectId: "jb-rrms-membership-system",
  storageBucket: "jb-rrms-membership-system.appspot.com",
  messagingSenderId: "493815911364",
  appId: "1:493815911364:web:e8f2270cf73d93dd368a91",
  measurementId: "G-07R6MZ6SL9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

const form = document.getElementById("joinForm");
const btn = document.getElementById("submitBtn");

form.addEventListener("submit", async (e)=>{
  e.preventDefault();

  const name = document.getElementById("name").value.trim();
  const father = document.getElementById("father").value.trim();
  const mobile = document.getElementById("mobile").value.trim();
  const address = document.getElementById("address").value.trim();
  const district = document.getElementById("district").value.trim();
  const state = document.getElementById("state").value;
  const photo = document.getElementById("photo").files[0];

  if(mobile.length !== 10){
    alert("рдХреГрдкрдпрд╛ 10 рдЕрдВрдХреЛрдВ рдХрд╛ рд╕рд╣реА рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ рджрд░реНрдЬ рдХрд░реЗрдВ");
    return;
  }

  if(!district){
    alert("рдХреГрдкрдпрд╛ рдЬрд┐рд▓рд╛ рджрд░реНрдЬ рдХрд░реЗрдВ");
    return;
  }

  if(!state){
    alert("рдХреГрдкрдпрд╛ рд░рд╛рдЬреНрдп рдЪреБрдиреЗрдВ");
    return;
  }

  if(!photo){
    alert("рдХреГрдкрдпрд╛ рдкрд╛рд╕рдкреЛрд░реНрдЯ рд╕рд╛рдЗрдЬ рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ");
    return;
  }

  btn.disabled = true;
  btn.innerText = "Uploading... рдХреГрдкрдпрд╛ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ";

  try{

    const storageRef = ref(storage, "members/" + Date.now() + "_" + photo.name);
    await uploadBytes(storageRef, photo);
    const photoURL = await getDownloadURL(storageRef);

    await addDoc(collection(db,"members"),{
      name,
      father,
      mobile,
      address,
      district,
      state,
      photoURL,
      createdAt: Timestamp.now()
    });

    alert("ЁЯЪй рдЬрдп рднрд╡рд╛рдиреА ЁЯЪй\nЁЯЪй рдЬрдп рд░рд╛рдЬрдкреВрддрд╛рдирд╛ ЁЯЪй\n\nрдЖрдкрдХрд╛ рд╕рджрд╕реНрдп рдлреЙрд░реНрдо рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЬрдорд╛ рд╣реЛ рдЧрдпрд╛ ЁЯЩП");

    form.reset();

  }catch(err){
    alert("тЭМ Error: " + err.message);
  }

  btn.disabled = false;
  btn.innerText = "Submit";

});

</script>

</body>
</html>
