<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>JBRRMS Join + ID Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{margin:0;background:#111;font-family:Arial}
#joinBox{max-width:360px;background:#fff;margin:30px auto;padding:20px;border-radius:8px}
#joinBox h2{text-align:center}
input,button{width:100%;padding:10px;margin:8px 0}
button{background:#e65100;color:#fff;border:none;cursor:pointer}
hr{margin:15px 0}
.card{display:none;position:relative;width:1080px;height:1676px;margin:30px auto;background-size:cover}
#front{background:url("https://ejdzdptqxelilkseannw.supabase.co/storage/v1/object/public/members/idcard_front.png") no-repeat center/cover}
.front-title{position:absolute;top:415px;width:100%;text-align:center;font-size:52px;font-weight:900;color:#ff6a00}
.photo{position:absolute;top:480px;left:390px;width:300px;height:380px;border-radius:24px;overflow:hidden;border:16px solid #d4af37;background:#fff}
.photo img{width:100%;height:100%;object-fit:cover}
.details{position:absolute;top:920px;width:100%;padding-left:280px;font-size:54px;line-height:1.6}
#c_code{margin-top:18px;font-weight:bold;letter-spacing:2px}
#back{background:url("https://ejdzdptqxelilkseannw.supabase.co/storage/v1/object/public/members/idcard_back.png") no-repeat center/cover}
.back-title{position:absolute;top:200px;width:100%;text-align:center;font-size:54px;font-weight:900;color:#ff6a00}
#qr{position:absolute;top:380px;left:50%;transform:translateX(-50%)}
.seven-lines{position:absolute;top:720px;left:50%;transform:translateX(-50%);width:720px;text-align:center;font-size:22px;line-height:1.5;font-weight:600}
.backtext{position:absolute;bottom:120px;width:100%;text-align:center;font-size:26px}
.actions{text-align:center;margin-bottom:40px}
.actions button{width:180px;margin:6px}
</style>
</head>

<body>

<div id="joinBox">
 <h2>JBRRMS Join / Search</h2>
 <input id="name" placeholder="‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ">
 <input id="post" placeholder="‡§™‡§¶">
 <input id="father" placeholder="‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ">
 <input id="district" placeholder="‡§ú‡§ø‡§≤‡§æ">
 <input id="state" placeholder="‡§∞‡§æ‡§ú‡•ç‡§Ø">
 <input id="mobile" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
 <input type="file" id="photoInput" accept="image/*">
 <button onclick="joinNow()">Join Now</button>
 <hr>
 <input id="searchCode" placeholder="Member Code (JBRRMS0001)">
 <button onclick="searchMember()">üÜî Search ID Card</button>
</div>

<div id="front" class="card">
 <div class="front-title">‡§ú‡§Ø ‡§≠‡§µ‡§æ‡§®‡•Ä ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§∞‡§æ‡§ú‡§™‡•Ç‡§§ ‡§Æ‡§π‡§æ‡§∏‡§≠‡§æ</div>
 <div class="photo"><img id="photo"></div>
 <div class="details">
  <div><b>‡§®‡§æ‡§Æ :</b> <span id="c_name"></span></div>
  <div><b>‡§™‡§¶ :</b> <span id="c_post"></span></div>
  <div><b>‡§™‡§ø‡§§‡§æ :</b> <span id="c_father"></span></div>
  <div><b>‡§ú‡§ø‡§≤‡§æ :</b> <span id="c_district"></span></div>
  <div><b>‡§∞‡§æ‡§ú‡•ç‡§Ø :</b> <span id="c_state"></span></div>
  <div><b>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ :</b> <span id="c_mobile"></span></div>
  <div id="c_code"></div>
 </div>
</div>

<div id="back" class="card">
 <div class="back-title">‡§ú‡§Ø ‡§≠‡§µ‡§æ‡§®‡•Ä ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§∞‡§æ‡§ú‡§™‡•Ç‡§§ ‡§Æ‡§π‡§æ‡§∏‡§≠‡§æ</div>
 <div id="qr"></div>
 <div class="seven-lines">
  ‡§™‡§¶ ‡§∏‡•á ‡§¨‡§°‡§º‡§æ ‡§∏‡•ç‡§µ‡§æ‡§≠‡§ø‡§Æ‡§æ‡§® ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§
 </div>
 <div class="backtext">
  ‡§π‡•á‡§≤‡•ç‡§™‡§≤‡§æ‡§á‡§®: 9166377972<br>
  Email: jbrrms1@gmail.com<br>
  Website: www.jbrrms.in
 </div>
</div>

<div class="actions">
 <button onclick="showFront()">‚¨Ö Front</button>
 <button onclick="showBack()">Back ‚û°</button>
 <button onclick="download()">‚¨á Download</button>
</div>

<script>
const sb = supabase.createClient(
 "https://ejdzdptqxelilkseannw.supabase.co",
 "sb_publishable_iU5rrjm63ImncflRhIkQYQ_QHyDR92P"
);

let blob=null, side="front";

photoInput.onchange=e=>{
 const i=new Image();
 i.src=URL.createObjectURL(e.target.files[0]);
 i.onload=()=>{
  const c=document.createElement("canvas");
  c.width=c.height=600;
  const x=c.getContext("2d");
  const s=Math.min(i.width,i.height);
  x.drawImage(i,(i.width-s)/2,(i.height-s)/2,s,s,0,0,600,600);
  c.toBlob(b=>blob=b,"image/jpeg",0.9);
 }
}

async function joinNow(){
 if(!blob) return alert("Photo required");

 const fd=new FormData();
 fd.append("file",blob);
 fd.append("upload_preset","jbrms_unsigned");

 const up=await fetch("https://api.cloudinary.com/v1_1/dlqr73p7j/image/upload",{method:"POST",body:fd});
 const img=await up.json();

 const {data,error}=await sb.from("JBRRMS").insert([{
   name: document.getElementById("name").value,
   post: document.getElementById("post").value,
   father: document.getElementById("father").value,
   district: document.getElementById("district").value,
   state: document.getElementById("state").value,
   mobile: document.getElementById("mobile").value,
   photo_url: img.secure_url
 }]).select("*").single();

 if(error) return alert(error.message);

 alert("Join ‡§∏‡§´‡§≤ ‚úîÔ∏è\nMember Code: "+data.member_code);
}

async function searchMember(){
 const code=searchCode.value.trim();
 if(!code) return alert("Member Code ‡§°‡§æ‡§≤‡•á‡§Ç");
 const {data,error}=await sb.from("JBRRMS").select("*").eq("member_code",code).single();
 if(error) return alert("Member not found");

 joinBox.style.display="none";
 front.style.display="block";

 c_name.innerText=data.name;
 c_post.innerText=data.post;
 c_father.innerText=data.father;
 c_district.innerText=data.district;
 c_state.innerText=data.state;
 c_mobile.innerText=data.mobile;
 c_code.innerText=data.member_code;
 photo.src=data.photo_url;

 qr.innerHTML="";
 new QRCode(qr,{text:data.member_code,width:300,height:300});
}

function showFront(){front.style.display="block";back.style.display="none"}
function showBack(){front.style.display="none";back.style.display="block"}
function download(){html2canvas(front,{scale:2,useCORS:true}).then(c=>{
 const a=document.createElement("a");
 a.download="JBRRMS_ID.png";
 a.href=c.toDataURL();
 a.click();
});}
</script>

</body>
</html>
