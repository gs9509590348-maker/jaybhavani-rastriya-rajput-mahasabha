<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>JBRRMS Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{margin:0;font-family:Arial;background:#f4f4f4}
header{background:#7b1fa2;color:#fff;padding:12px;text-align:center;font-size:18px;font-weight:700}
.container{padding:10px}

.controls{display:flex;gap:6px;margin-bottom:8px}
.controls input,.controls select{
 flex:1;padding:6px;font-size:13px
}

table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ccc;padding:6px;font-size:12px;text-align:center}
th{background:#eee}

button{padding:4px 7px;font-size:11px;border:none;border-radius:4px;cursor:pointer}
.approve{background:#2e7d32;color:#fff}
.reject{background:#c62828;color:#fff}
.hook{background:#1565c0;color:#fff}

.status-Pending{color:#ff9800;font-weight:700}
.status-Approved{color:#2e7d32;font-weight:700}
.status-Rejected{color:#c62828;font-weight:700}
</style>
</head>

<body>
<header>JBRRMS – Admin Panel</header>

<div class="container">

<div class="controls">
 <input id="search" placeholder="नाम / मोबाइल / Member ID">
 <select id="statusFilter">
  <option value="All">All</option>
  <option value="Pending">Pending</option>
  <option value="Approved">Approved</option>
  <option value="Rejected">Rejected</option>
 </select>
</div>

<table>
<thead>
<tr>
 <th>ID</th>
 <th>Name</th>
 <th>Post</th>
 <th>Mobile</th>
 <th>District</th>
 <th>Status</th>
 <th>Action</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

</div>

<script>
const sb = supabase.createClient(
 "https://ejdzdptqxelilkseannw.supabase.co",
 "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqZHpkcHRxeGVsaWxrc2Vhbm53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MTE2MTYsImV4cCI6MjA4MzI4NzYxNn0.j3V1D7Ha2SlKwM9cCCHXlFOzAACQZQ4PVXBIkLq4_cc"
);

const tbody = document.getElementById("tbody");
const search = document.getElementById("search");
const statusFilter = document.getElementById("statusFilter");

async function loadMembers(){
 let q = sb.from("JBRRMS").select("*").order("id",{ascending:false});

 if(statusFilter.value!=="All"){
  q = q.eq("status",statusFilter.value);
 }

 const {data,error} = await q;
 if(error){console.log(error);return;}

 const term = search.value.toLowerCase();

 tbody.innerHTML="";
 data.filter(m=>{
  return !term ||
   (m.name||"").toLowerCase().includes(term) ||
   (m.mobile||"").includes(term) ||
   (m.member_code||"").toLowerCase().includes(term);
 }).forEach(m=>{
  tbody.innerHTML += `
  <tr>
   <td>${m.id}</td>
   <td>${m.name}</td>
   <td>${m.post||"-"}</td>
   <td>${m.mobile}</td>
   <td>${m.district||"-"}</td>
   <td class="status-${m.status}">${m.status}</td>
   <td>
    ${m.status==="Pending"?`
     <button class="approve" onclick="approve(${m.id})">Approve</button>
     <button class="reject" onclick="reject(${m.id})">Reject</button>
    `:`
     <button class="hook">ID Card</button>
     <button class="hook">Cert</button>
     <button class="hook">Appt</button>
    `}
   </td>
  </tr>`;
 });
}

async function approve(id){
 const code = "JBRRMS"+String(id).padStart(4,"0");

 await sb.from("JBRRMS")
  .update({status:"Approved",member_code:code})
  .eq("id",id);

 loadMembers();
}

async function reject(id){
 await sb.from("JBRRMS")
  .update({status:"Rejected"})
  .eq("id",id);

 loadMembers();
}

search.oninput = loadMembers;
statusFilter.onchange = loadMembers;

loadMembers();
</script>

</body>
</html>
