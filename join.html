<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>JBRRMS тАУ Join & ID Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{margin:0;background:#0e0e0e;font-family:Arial}
#joinBox{max-width:400px;background:#fff;margin:20px auto;padding:18px;border-radius:12px}
h2{text-align:center;margin:0 0 10px}
input,button{width:100%;padding:10px;margin:6px 0;font-size:15px}
button{background:#c69214;color:#fff;border:none;font-weight:800;border-radius:6px;cursor:pointer}
label{font-size:13px;display:block;margin:8px 0}

.card{display:none;position:relative;width:1080px;height:1676px;margin:20px auto}
#front{background:url("https://ejdzdptqxelilkseannw.supabase.co/storage/v1/object/public/members/idcard_front.png") center/cover}
#back{background:url("https://ejdzdptqxelilkseannw.supabase.co/storage/v1/object/public/members/idcard_back.png") center/cover}

.front-title,.back-title{
position:absolute;width:100%;text-align:center;font-weight:900;
background:linear-gradient(#fff2b0,#f5c542,#d4af37);
-webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.front-title{top:395px;font-size:58px}
.back-title{top:200px;font-size:60px}

.photo{
position:absolute;top:500px;left:390px;
width:300px;height:380px;border-radius:26px;
overflow:hidden;border:18px solid #d4af37;background:#fff
}
.photo img{width:100%;height:100%;object-fit:cover}

.details{position:absolute;top:900px;padding-left:260px;font-size:48px;line-height:1.6}
#c_code{margin-top:14px;font-weight:900;letter-spacing:3px}

#qr{position:absolute;top:380px;left:50%;transform:translateX(-50%)}

.swabhiman{
position:absolute;top:980px;left:120px;right:120px;
text-align:center;font-size:34px;line-height:1.4;
font-weight:700;color:#3b2b00;
}
.disclaimer{
margin-top:20px;font-size:26px;font-weight:500;color:#444;
}

.actions{text-align:center;margin:20px}
.actions button{width:180px;margin:6px}
</style>
</head>

<body>

<div id="joinBox">
<h2>JBRRMS Join Form</h2>
<input id="name" placeholder="рдкреВрд░рд╛ рдирд╛рдо *">
<input id="father" placeholder="рдкрд┐рддрд╛ рдХрд╛ рдирд╛рдо">
<input id="district" placeholder="рдЬрд┐рд▓рд╛">
<input id="state" placeholder="рд░рд╛рдЬреНрдп">
<input id="post" placeholder="рдкрдж *">
<input id="mobile" placeholder="рдореЛрдмрд╛рдЗрд▓ (10 рдЕрдВрдХ) *">

<input type="file" id="photoInput" accept="image/*" hidden>
<button onclick="openPicker()">ЁЯУ╕ рдлреЛрдЯреЛ рдЪреБрдиреЗрдВ</button>
<div id="photoStatus"></div>

<label><input type="checkbox" id="agree" style="width:auto"> рдирд┐рдпрдо рд╕реНрд╡реАрдХрд╛рд░</label>
<button onclick="joinNow()">Join Now</button>

<hr>

<input id="searchInput" placeholder="Member Code рдпрд╛ Mobile">
<button onclick="searchMember()">ЁЯЖФ ID Card рджреЗрдЦреЗрдВ</button>
</div>

<!-- FRONT -->
<div id="front" class="card">
<div class="front-title">рдЬрдп рднрд╡рд╛рдиреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рд░рд╛рдЬрдкреВрдд рдорд╣рд╛рд╕рднрд╛</div>
<div class="photo"><img id="photoFront"></div>
<div class="details">
<div><b>рдирд╛рдо :</b> <span id="c_name"></span></div>
<div><b>рдкрд┐рддрд╛ :</b> <span id="c_father"></span></div>
<div><b>рдЬрд┐рд▓рд╛ :</b> <span id="c_district"></span></div>
<div><b>рд░рд╛рдЬреНрдп :</b> <span id="c_state"></span></div>
<div><b>рдкрдж :</b> <span id="c_post"></span></div>
<div><b>рдореЛрдмрд╛рдЗрд▓ :</b> <span id="c_mobile"></span></div>
<div id="c_code"></div>
</div>
</div>

<!-- BACK -->
<div id="back" class="card">
<div class="back-title">рдЬрдп рднрд╡рд╛рдиреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рд░рд╛рдЬрдкреВрдд рдорд╣рд╛рд╕рднрд╛</div>
<div id="qr"></div>
<div class="photo" style="top:520px"><img id="photoBack"></div>

<div class="swabhiman">
<div>рдкрдж рд╕реЗ рдмрдбрд╝рд╛ рд╕реНрд╡рд╛рднрд┐рдорд╛рди рд╣реЛрддрд╛ рд╣реИред</div>
<div>рд╕реНрд╡рд╛рднрд┐рдорд╛рди рд╣реИ рддреЛ рдкрд╣рдЪрд╛рди рд╣реИред</div>
<div>рд╕реНрд╡рд╛рднрд┐рдорд╛рди рдХрднреА рдЧрд┐рд░рд╡реА рдирд╣реАрдВ рд░рдЦрд╛ рдЬрд╛рддрд╛ред</div>
<div>рд╕реНрд╡рд╛рднрд┐рдорд╛рди рд╣реА рдЕрд╕рд▓реА рд╢рдХреНрддрд┐ рд╣реИред</div>
<div>рдЬрд┐рд╕рдХреЗ рдкрд╛рд╕ рд╕реНрд╡рд╛рднрд┐рдорд╛рди рд╣реИ, рд╡рд╣реА рд╕рдЪреНрдЪрд╛ рдмрд▓рд╡рд╛рди рд╣реИред</div>
<div>рд╕реНрд╡рд╛рднрд┐рдорд╛рди рд╕рдордЭреМрддрд╛ рдирд╣реАрдВ рд╕рд┐рдЦрд╛рддрд╛ред</div>
<div>рд╕реНрд╡рд╛рднрд┐рдорд╛рди рд╣рдорд╛рд░реА рдЕрд╕рд▓реА рд╡рд┐рд░рд╛рд╕рдд рд╣реИред</div>

<div class="disclaimer">
рдпрд╣ рдкрд╣рдЪрд╛рди рдкрддреНрд░ рдХреЗрд╡рд▓ рд╕рдВрдЧрдардирд╛рддреНрдордХ рдкрд╣рдЪрд╛рди рд╣реЗрддреБ рд╣реИред
</div>
</div>
</div>

<div class="actions">
<button onclick="showFront()">тмЕ Front</button>
<button onclick="showBack()">Back тЮб</button>
<button onclick="download()">тмЗ Download</button>
</div>

<script>
const sb = supabase.createClient(
 "https://ejdzdptqxelilkseannw.supabase.co",
 "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqZHpkcHRxeGVsaWxrc2Vhbm53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MTE2MTYsImV4cCI6MjA4MzI4NzYxNn0.j3V1D7Ha2SlKwM9cCCHXlFOzAACQZQ4PVXBIkLq4_cc"
);

const el=id=>document.getElementById(id);
const name=el("name"),father=el("father"),district=el("district"),
state=el("state"),post=el("post"),mobile=el("mobile"),agree=el("agree");
const photoInput=el("photoInput"),photoStatus=el("photoStatus");
const searchInput=el("searchInput");
const front=el("front"),back=el("back");
const photoFront=el("photoFront"),photoBack=el("photoBack");
const c_name=el("c_name"),c_father=el("c_father"),
c_district=el("c_district"),c_state=el("c_state"),
c_post=el("c_post"),c_mobile=el("c_mobile"),
c_code=el("c_code"),qr=el("qr");

let photoBlob=null,side="front";

function openPicker(){photoInput.value="";photoInput.click();}

photoInput.onchange=e=>{
const f=e.target.files[0]; if(!f) return;
const img=new Image(),u=URL.createObjectURL(f); img.src=u;
img.onload=()=>{
const c=document.createElement("canvas"); c.width=c.height=600;
const m=Math.min(img.width,img.height);
c.getContext("2d").drawImage(img,(img.width-m)/2,(img.height-m)/2,m,m,0,0,600,600);
c.toBlob(b=>{photoBlob=b;photoStatus.textContent="Photo ready тЬЕ";},"image/jpeg",0.85);
};
};

async function joinNow(){
if(!photoBlob||!name.value||!mobile.value||!post.value||!agree.checked){
alert("рд╕рднреА рдЬрд░реВрд░реА рдлреАрд▓реНрдб рднрд░реЗрдВ");return;
}
if(!/^\d{10}$/.test(mobile.value)){alert("рдореЛрдмрд╛рдЗрд▓ рдЧрд▓рдд");return;}

const {data:ex}=await sb.from("JBRRMS").select("id").eq("mobile",mobile.value).maybeSingle();
if(ex){alert("рдореЛрдмрд╛рдЗрд▓ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж");return;}

const fd=new FormData();
fd.append("file",photoBlob);
fd.append("upload_preset","jbrms_unsigned");

const up=await fetch("https://api.cloudinary.com/v1_1/dlqr73p7j/image/upload",{method:"POST",body:fd}).then(r=>r.json());

await sb.from("JBRRMS").insert([{
name:name.value,
father_name:father.value,
district:district.value,
state:state.value,
post:post.value,
mobile:mobile.value,
photo_url:up.secure_url,
status:"Pending"
}]);

alert("Submitted тАУ Approval Pending ЁЯЪй");
}

async function searchMember(){
const v=searchInput.value.trim(); if(!v)return;
let q=sb.from("JBRRMS").select("*").eq("status","Approved");
q=/^\d{10}$/.test(v)?q.eq("mobile",v):q.eq("member_code",v);
const {data}=await q.maybeSingle();
if(!data){alert("Member рдирд╣реАрдВ рдорд┐рд▓рд╛");return;}

photoFront.src=photoBack.src=data.photo_url;
c_name.textContent=data.name;
c_father.textContent=data.father_name||"";
c_district.textContent=data.district||"";
c_state.textContent=data.state||"";
c_post.textContent=data.post||"";
c_mobile.textContent=data.mobile;
c_code.textContent=data.member_code;

qr.innerHTML="";
new QRCode(qr,{text:data.member_code,width:220,height:220});
showFront();
}

function showFront(){front.style.display="block";back.style.display="none";side="front";}
function showBack(){front.style.display="none";back.style.display="block";side="back";}

function download(){
html2canvas(side==="front"?front:back,{scale:2,useCORS:true}).then(c=>{
const a=document.createElement("a");
a.href=c.toDataURL("image/png");
a.download="JBRRMS_"+side+".png";
a.click();
});
}
</script>

</body>
</html>
