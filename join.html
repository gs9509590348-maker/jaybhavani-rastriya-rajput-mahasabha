<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>JB RRMS - рд╕рджрд╕реНрдп рдкрдВрдЬреАрдХрд░рдг</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family: system-ui;background:#f4f4f4;padding:20px}
.container{max-width:600px;margin:auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 10px #ccc}
h2{text-align:center}
input,select{width:100%;padding:10px;margin:6px 0;border-radius:6px;border:1px solid #ccc}
button{background:#007bff;color:#fff;border:none;padding:12px;width:100%;border-radius:8px;font-size:16px}
.success{color:green;font-weight:600}
.error{color:red;font-weight:600}
#preview{width:120px;height:140px;object-fit:cover;border:1px solid #ccc;border-radius:8px;margin-top:10px}
</style>
</head>

<body>
<div class="container">
<h2>рдЬрдп рднрд╡рд╛рдиреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рд░рд╛рдЬрдкреВрдд рдорд╣рд╛рд╕рднрд╛<br>ЁЯУЭ рд╕рджрд╕реНрдп рдкрдВрдЬреАрдХрд░рдг</h2>

<input id="name" placeholder="рдкреВрд░рд╛ рдирд╛рдо рд▓рд┐рдЦреЗрдВ" required>
<input id="father" placeholder="рдкрд┐рддрд╛ рдХрд╛ рдирд╛рдо" required>
<input id="mobile" placeholder="рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ (10 рдЕрдВрдХ)" maxlength="10" required>
<input id="address" placeholder="рдкреВрд░рд╛ рдкрддрд╛" required>

<input id="district" placeholder="рдЬрд┐рд▓рд╛" required>

<select id="state" required>
<option value="">рд░рд╛рдЬреНрдп рдЪреБрдиреЗрдВ</option>
<option>Rajasthan</option>
<option>Uttar Pradesh</option>
<option>Madhya Pradesh</option>
<option>Gujarat</option>
<option>Maharashtra</option>
<option>Bihar</option>
<option>Haryana</option>
<option>Delhi</option>
<option>Punjab</option>
<option>Other</option>
</select>

<label>ЁЯУ╕ рдкрд╛рд╕рдкреЛрд░реНрдЯ рд╕рд╛рдЗрдЬ рдлреЛрдЯреЛ рдЪреБрдиреЗрдВ</label>
<input type="file" id="photo" accept="image/*" required>

<img id="preview" style="display:none" />

<button id="submitBtn">Submit</button>

<p id="msg"></p>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, addDoc, Timestamp } 
  from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } 
  from "https://www.gstatic.com/firebasejs/12.7.0/firebase-storage.js";

const firebaseConfig = {  
  apiKey: "AIzaSyBQpzc5xAvInmSCbzsZiy7TpD0OXVyij_4",
  authDomain: "jb-rrms-membership-system.firebaseapp.com",
  projectId: "jb-rrms-membership-system",
  storageBucket: "jb-rrms-membership-system.appspot.com",
  messagingSenderId: "493815911364",
  appId: "1:493815911364:web:e8f2270cf73d93dd368a91"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

// тнР рдлреЛрдЯреЛ рдЪреБрдирддреЗ рд╣реА Preview
photo.addEventListener("change", ()=>{
  const file = photo.files[0];
  if(file){
    document.getElementById("preview").src = URL.createObjectURL(file);
    document.getElementById("preview").style.display="block";
  }
});

// тнР Submit Function
submitBtn.addEventListener("click", async ()=>{

  const name = name.value.trim();
  const father = father.value.trim();
  const mobile = mobile.value.trim();
  const address = address.value.trim();
  const district = district.value.trim();
  const state = state.value;
  const file = photo.files[0];
  const msg = msg;
  const btn = submitBtn;

  if(!name || !father || !mobile || !address || !district || !state || !file){
    msg.innerHTML = "тЭМ рдХреГрдкрдпрд╛ рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рднрд░реЗрдВ";
    msg.className="error";
    return;
  }

  if(mobile.length !== 10){
    msg.innerHTML = "ЁЯУЮ рд╕рд╣реА 10 рдЕрдВрдХреЛрдВ рдХрд╛ рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ рдбрд╛рд▓реЗрдВ";
    msg.className="error";
    return;
  }

  try{
    btn.disabled = true;
    btn.innerText = "Uploading...";

    // Upload Photo
    const storageRef = ref(storage,"member_photos/"+Date.now()+"_"+file.name);
    await uploadBytes(storageRef,file);
    const photoURL = await getDownloadURL(storageRef);

    // Save Firestore
    await addDoc(collection(db,"members"),{
      name,father,mobile,address,district,state,
      photoURL,
      status:"pending",
      createdAt:Timestamp.now()
    });

    msg.innerHTML = "тЬФ рдкрдВрдЬреАрдХрд░рдг рд╕рдлрд▓ ЁЯЩП рдПрдбрдорд┐рди рдЕрдкреНрд░реВрд╡рд▓ рдХреЗ рдмрд╛рдж ID рдЬрд╛рд░реА рд╣реЛрдЧреА";
    msg.className="success";

    name.value=father.value=mobile.value=address.value=district.value="";
    state.value="";
    photo.value="";
    preview.style.display="none";

  }catch(e){
    msg.innerHTML = "тЭМ Error: "+e.message;
    msg.className="error";
  }

  btn.disabled = false;
  btn.innerText = "Submit";

});

</script>

</body>
</html>
