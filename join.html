<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>рдЬрдп рднрд╡рд╛рдиреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рд░рд╛рдЬрдкреВрдд рдорд╣рд╛рд╕рднрд╛ тАУ Digital System</title>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Mangal,Arial;background:#f2f2f2;margin:0;padding:10px}
input,button{width:100%;padding:10px;margin:6px 0;font-size:16px}
button{background:#8b0000;color:#fff;border:none;border-radius:6px}
canvas{width:100%;max-width:1080px;border:2px solid #aaa;margin-top:10px;background:#fff}
.section{background:#fff;padding:10px;border-radius:8px;margin-bottom:10px}
</style>
</head>

<body>

<h2 align="center">рдЬрдп рднрд╡рд╛рдиреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рд░рд╛рдЬрдкреВрдд рдорд╣рд╛рд╕рднрд╛</h2>

<div class="section">
<h3>ЁЯУЭ рд╕рджрд╕реНрдп рдЬреНрд╡рд╛рдЗрди рдлреЙрд░реНрдо</h3>
<input id="name" placeholder="рдирд╛рдо">
<input id="fname" placeholder="рдкрд┐рддрд╛ рдХрд╛ рдирд╛рдо">
<input id="mobile" placeholder="рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░">
<input id="district" placeholder="рдЬрд┐рд▓рд╛">
<input id="state" placeholder="рд░рд╛рдЬреНрдп">
<input type="file" id="photo" accept="image/*">
<button onclick="joinMember()">Join & Generate</button>
</div>

<div class="section">
<h3>ЁЯФН Member ЁЯЖФ рд╕реЗ рд╕рд░реНрдЪ</h3>
<input id="searchCode" placeholder="Member Code (JBRRMS0001)">
<button onclick="searchMember()">Search & Generate</button>
</div>

<canvas id="certificate" width="1080" height="1678"></canvas>
<canvas id="idfront" width="540" height="856"></canvas>
<canvas id="idback" width="540" height="856"></canvas>

<div class="section">
<button onclick="downloadPNG('certificate')">ЁЯУе Certificate</button>
<button onclick="downloadPNG('idfront')">ЁЯУе ID Front</button>
<button onclick="downloadPNG('idback')">ЁЯУе ID Back</button>
<button onclick="downloadPDF()">ЁЯУД PDF</button>
</div>

<script>
let memberCode="";

const certBG=new Image(); certBG.src="certificate.png";
const idFront=new Image(); idFront.src="idcard_front.png";
const idBack=new Image(); idBack.src="idcard_back.png";
const logo=new Image(); logo.src="logo.png";

CanvasRenderingContext2D.prototype.roundRect=
CanvasRenderingContext2D.prototype.roundRect||
function(x,y,w,h,r){
 this.moveTo(x+r,y);
 this.arcTo(x+w,y,x+w,y+h,r);
 this.arcTo(x+w,y+h,x,y+h,r);
 this.arcTo(x,y+h,x,y,r);
 this.arcTo(x,y,x+w,y,r);
};

function joinMember(){
 if(!name.value){alert("рдирд╛рдо рдЕрдирд┐рд╡рд╛рд░реНрдп рд╣реИ");return;}
 memberCode="JBRRMS"+String(Date.now()).slice(-4);
 generateAll();
}

function searchMember(){
 if(!searchCode.value){alert("Member Code рдбрд╛рд▓реЗрдВ");return;}
 memberCode=searchCode.value;
 generateAll();
}

function generateAll(){
 generateCertificate();
 generateID();
}

/* ================= CERTIFICATE ================= */
function generateCertificate(){
 const c=certificate.getContext("2d");
 c.clearRect(0,0,1080,1678);
 c.drawImage(certBG,0,0,1080,1678);
 c.drawImage(logo,390,40,300,300);

 c.font="bold 60px serif";
 c.fillStyle="#7a0000";
 c.textAlign="center";
 c.fillText("рдкреНрд░рдорд╛рдг рдкрддреНрд░",540,430);

 c.font="30px serif";
 c.fillStyle="#000";
 c.textAlign="left";

 let y=560,g=55;
 line("рдирд╛рдо",name.value);
 line("рдкрд┐рддрд╛ рдХрд╛ рдирд╛рдо",fname.value);
 line("рдореЛрдмрд╛рдЗрд▓",mobile.value);
 line("рдЬрд┐рд▓рд╛",district.value);
 line("рд░рд╛рдЬреНрдп",state.value);
 line("рд╕рджрд╕реНрдп рдХреЛрдб",memberCode);

 function line(l,v){
  c.fillText(l+" :",200,y);
  c.textAlign="right";
  c.fillText(v,880,y);
  c.textAlign="left";
  y+=g;
 }

 c.save();
 c.translate(70,1200);
 c.rotate(-Math.PI/2);
 c.font="22px serif";
 c.fillText("рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди : 9166377972",0,0);
 c.fillText("рдИрдореЗрд▓ : jbrrms1@gmail.com",0,35);
 c.fillText("рд╡реЗрдмрд╕рд╛рдЗрдЯ : www.jbrrms.in",0,70);
 c.restore();

 drawQR(c,760,980,qrURL());

 c.font="18px serif";
 c.textAlign="center";
 c.fillText(
 "рдпрд╣ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреЗрд╡рд▓ рд╕рдВрдЧрдардирд╛рддреНрдордХ рдкрд╣рдЪрд╛рди рд╣реЗрддреБ рд╣реИред рдЗрд╕рдХрд╛ рдХрд┐рд╕реА рднреА рд╕рд░рдХрд╛рд░реА рдЕрдзрд┐рдХрд╛рд░ рд╕реЗ рд╕рдВрдмрдВрдз рдирд╣реАрдВ рд╣реИред",
 540,1600
 );
}

/* ================= ID CARD ================= */
function generateID(){
 /* FRONT */
 const f=idfront.getContext("2d");
 f.clearRect(0,0,540,856);
 f.drawImage(idFront,0,0,540,856);
 drawPhotoCover(f,150,260,240,300);

 f.font="20px serif";
 f.fillStyle="#000";
 f.fillText(name.value,140,610);
 f.fillText(memberCode,140,645);
 f.fillText(district.value,140,680);

 /* BACK (тЬФ FIXED) */
 const b=idback.getContext("2d");
 b.clearRect(0,0,540,856);
 b.drawImage(idBack,0,0,540,856);

 // NAME TOP
 b.font="bold 22px serif";
 b.textAlign="center";
 b.fillStyle="#000";
 b.fillText(name.value,270,90);

 // QR CENTER
 drawQR(b,150,200,qrURL());

 // CONTACT INFO BOTTOM
 b.font="16px serif";
 b.fillText("рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди : 9166377972",270,540);
 b.fillText("рдИрдореЗрд▓ : jbrrms1@gmail.com",270,570);
 b.fillText("рд╡реЗрдмрд╕рд╛рдЗрдЯ : www.jbrrms.in",270,600);

 // DISCLAIMER
 b.font="14px serif";
 b.fillStyle="#333";
 b.fillText(
 "рдпрд╣ рдХрд╛рд░реНрдб рдХреЗрд╡рд▓ рд╕рдВрдЧрдардирд╛рддреНрдордХ рдкрд╣рдЪрд╛рди рд╣реЗрддреБ рд╣реИред",
 270,640
 );
}

/* ===== PHOTO AUTO FIT ===== */
function drawPhotoCover(ctx,x,y,w,h){
 if(!photo.files[0])return;
 const img=new Image();
 img.onload=()=>{
  const ir=img.width/img.height,cr=w/h;
  let sx,sy,sw,sh;
  if(ir>cr){sh=img.height;sw=sh*cr;sx=(img.width-sw)/2;sy=0;}
  else{sw=img.width;sh=sw/cr;sx=0;sy=(img.height-sh)/2;}
  ctx.save();
  ctx.beginPath();
  ctx.roundRect(x,y,w,h,20);
  ctx.clip();
  ctx.drawImage(img,sx,sy,sw,sh,x,y,w,h);
  ctx.restore();
 };
 img.src=URL.createObjectURL(photo.files[0]);
}

/* ===== QR WEBSITE ===== */
function qrURL(){
 return "https://www.jbrrms.in/?member="+memberCode;
}

function drawQR(ctx,x,y,text){
 QRCode.toCanvas(document.createElement("canvas"),text,{width:240},(e,qr)=>{
  ctx.drawImage(qr,x,y);
 });
}

/* ===== DOWNLOAD ===== */
function downloadPNG(id){
 const a=document.createElement("a");
 a.href=document.getElementById(id).toDataURL("image/png");
 a.download=memberCode+"_"+id+".png";
 a.click();
}

function downloadPDF(){
 const {jsPDF}=window.jspdf;
 const pdf=new jsPDF("p","px",[1080,1678]);
 pdf.addImage(certificate.toDataURL(),"PNG",0,0,1080,1678);
 pdf.addPage([540,856],"p");
 pdf.addImage(idfront.toDataURL(),"PNG",0,0,540,856);
 pdf.addPage([540,856],"p");
 pdf.addImage(idback.toDataURL(),"PNG",0,0,540,856);
 pdf.save(memberCode+"_JB_RRMS.pdf");
}
</script>

</body>
</html>
