<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Admin Panel | ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡§æ‡§∞‡§ø‡§£‡•Ä ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f4f4f4;margin:0}
header{background:#7b0000;color:#fff;padding:15px;text-align:center}
.container{
  max-width:1100px;margin:20px auto;
  background:#fff;padding:20px;border-radius:10px
}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:8px;font-size:14px;text-align:center}
th{background:#eee}
img{width:50px;height:50px;border-radius:50%;object-fit:cover}
input,select{width:100%;padding:6px}
button{
  padding:6px 10px;border:none;border-radius:4px;
  cursor:pointer;font-size:13px
}
.up,.down{background:#ffc107}
.delete{background:#dc3545;color:#fff}
.add{background:#28a745;color:#fff}
.footer{text-align:center;font-size:13px;color:#555;margin:30px 0}
textarea{width:100%;height:220px}
.note{background:#fff3cd;padding:10px;border-left:4px solid #ff9800;margin-bottom:15px}
</style>
</head>

<body>

<script>
/* üîê ADMIN PROTECTION */
if(sessionStorage.getItem("admin")!=="1"){
  alert("Unauthorized Access");
  location.href="../admin_login.html";
}
</script>

<header>
  <h2>üîê Admin Panel ‚Äì ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡§æ‡§∞‡§ø‡§£‡•Ä ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®</h2>
</header>

<div class="container">

<div class="note">
<b>‡§®‡•ã‡§ü:</b> ‡§∏‡§≠‡•Ä ‡§¨‡§¶‡§≤‡§æ‡§µ browser ‡§Æ‡•á‡§Ç ‡§π‡•ã‡§Ç‡§ó‡•á‡•§  
‡§®‡•Ä‡§ö‡•á ‡§¨‡§®‡•á <b>Updated JSON</b> ‡§ï‡•ã copy ‡§ï‡§∞‡§ï‡•á  
<code>data/karyakarini.json</code> ‡§Æ‡•á‡§Ç paste ‡§ï‡§∞‡•á‡§Ç‡•§
</div>

<!-- ADD NEW MEMBER -->
<h3>‚ûï ‡§®‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡§æ‡§∞‡§ø‡§£‡•Ä ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h3>
<table>
<tr>
<td><input id="n_name" placeholder="Name"></td>
<td><input id="n_post" placeholder="Post"></td>
<td>
<select id="n_level">
  <option>‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø</option>
  <option>‡§™‡•ç‡§∞‡§¶‡•á‡§∂</option>
  <option>‡§ú‡§ø‡§≤‡§æ</option>
</select>
</td>
<td><input id="n_district" placeholder="District"></td>
<td><input id="n_state" placeholder="State"></td>
<td><input id="n_mobile" placeholder="Mobile"></td>
<td><input id="n_photo" placeholder="Photo URL"></td>
<td><button class="add" onclick="addMember()">‚ûï Add</button></td>
</tr>
</table>

<hr>

<!-- EXISTING MEMBERS -->
<h3>‚úèÔ∏è Edit / Delete / Reorder</h3>
<table>
<thead>
<tr>
<th>Order</th>
<th>Photo</th>
<th>Name</th>
<th>Post</th>
<th>Level</th>
<th>District</th>
<th>State</th>
<th>Mobile</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<h3>üì¶ Updated JSON (Copy & Paste)</h3>
<textarea id="jsonOut"></textarea>

</div>

<div class="footer">
¬© 2025 ‡§ú‡§Ø ‡§≠‡§µ‡§æ‡§®‡•Ä ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§∞‡§æ‡§ú‡§™‡•Ç‡§§ ‡§Æ‡§π‡§æ‡§∏‡§≠‡§æ<br>
Admin use only
</div>

<script>
/* ‚úÖ SAFE ABSOLUTE PATH */
const JSON_PATH = "../data/karyakarini.json";

let data=[];

fetch(JSON_PATH)
.then(r=>r.json())
.then(j=>{
  data = j.karyakarini.filter(x=>x.active!==false);
  normalizeOrder();
  render();
})
.catch(()=>{
  alert("karyakarini.json load ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ ‡§∞‡§π‡§æ");
});

function normalizeOrder(){
  data.sort((a,b)=>a.order-b.order);
  data.forEach((m,i)=>m.order=i+1);
}

function nextId(){
  return "KAR-" + String(data.length+1).padStart(3,"0");
}

function addMember(){
  if(!n_name.value || !n_post.value){
    alert("Name ‡§î‡§∞ Post ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à");
    return;
  }
  data.push({
    id:nextId(),
    name:n_name.value,
    post:n_post.value,
    level:n_level.value,
    district:n_district.value,
    state:n_state.value,
    mobile:n_mobile.value,
    photo:n_photo.value,
    order:data.length+1,
    active:true
  });
  clearNew();
  render();
}

function clearNew(){
  n_name.value=n_post.value=n_district.value=
  n_state.value=n_mobile.value=n_photo.value="";
}

function render(){
  const tb=document.getElementById("tbody");
  tb.innerHTML="";
  data.forEach((m,i)=>{
    tb.innerHTML+=`
    <tr>
      <td>${m.order}</td>
      <td><img src="${m.photo||'https://via.placeholder.com/50'}"></td>
      <td><input value="${m.name}" onchange="upd(${i},'name',this.value)"></td>
      <td><input value="${m.post}" onchange="upd(${i},'post',this.value)"></td>
      <td>
        <select onchange="upd(${i},'level',this.value)">
          <option ${m.level=='‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø'?'selected':''}>‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø</option>
          <option ${m.level=='‡§™‡•ç‡§∞‡§¶‡•á‡§∂'?'selected':''}>‡§™‡•ç‡§∞‡§¶‡•á‡§∂</option>
          <option ${m.level=='‡§ú‡§ø‡§≤‡§æ'?'selected':''}>‡§ú‡§ø‡§≤‡§æ</option>
        </select>
      </td>
      <td><input value="${m.district||''}" onchange="upd(${i},'district',this.value)"></td>
      <td><input value="${m.state||''}" onchange="upd(${i},'state',this.value)"></td>
      <td><input value="${m.mobile||''}" onchange="upd(${i},'mobile',this.value)"></td>
      <td>
        <button class="up" onclick="moveUp(${i})">‚¨Ü</button>
        <button class="down" onclick="moveDown(${i})">‚¨á</button>
        <button class="delete" onclick="del(${i})">‚ùå</button>
      </td>
    </tr>`;
  });

  document.getElementById("jsonOut").value =
JSON.stringify({
  last_updated:new Date().toISOString().split("T")[0],
  organization:"‡§ú‡§Ø ‡§≠‡§µ‡§æ‡§®‡•Ä ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§∞‡§æ‡§ú‡§™‡•Ç‡§§ ‡§Æ‡§π‡§æ‡§∏‡§≠‡§æ",
  karyakarini:data
},null,2);
}

function upd(i,k,v){data[i][k]=v;render();}
function del(i){
  if(confirm("Delete this member?")){
    data.splice(i,1);
    normalizeOrder();
    render();
  }
}
function moveUp(i){
  if(i===0) return;
  [data[i],data[i-1]]=[data[i-1],data[i]];
  normalizeOrder();render();
}
function moveDown(i){
  if(i===data.length-1) return;
  [data[i],data[i+1]]=[data[i+1],data[i]];
  normalizeOrder();render();
}
</script>

</body>
</html>
